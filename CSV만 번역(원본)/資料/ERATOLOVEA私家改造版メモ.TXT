【eraToLoveA사가판 한글 번역 버전_メモ】
書いた人：りりー(원작자)/도검난무 채널(역자)
最終更新：2021/10/04

・このメモはeraToLoveAを改造するにあたって
どのような実装をしたのか、実装してどうなったか、などを雑多に書いたものです
※思い出したら増えます

・読まなくてもプレイに問題ありません

・입上・パッチ作成するにあたってお役に立てば幸いです

・不明点や質問などありましたら、お気軽にどうぞ

--------------------
目次
1.FLAG、CFLAGなど変数関連
2.アイテム関連
3.個体差・素質関連
4.극関連
5.コマンド関連
6.内番関連
7.입上関連
8.その他
9.更新に伴う修正の補발など
--------------------
1.FLAG、CFLAGなど変数関連
・CFLAG:30　도종フラグ
	キャラの도종を保持するフラグです
	CSVで直接指定してください
		@LOSTNAMEでキャラのCSVで設定されている名前・あだ名・도종・도파を取得できます
	도종を判定して何かする処理は現状ありませんが、ないよりはあった方がいいかと思い追加しました
	
・CFLAG:31　도파フラグ
	キャラの도파を保持するフラグです
	CSVで直接指定してください
		@LOSTNAMEでキャラのCSVで設定されている名前・あだ名・도종・도파を取得できます
	도파なしキャラは「0」を指定してください

・FLAG:1000-1999の保持内容変更
	保持内容をキャラの値段とキャラ購入の未既判断→淫系素質獲得履歴に変更
	FLAG:2000以降は空きましたﾔｯﾀｰ

・ITEMPRICE、ITEMSALES
	キャラの値段はITEMPRICEで保持するように変更（ITEM.csvで定義）
		ITEMPRICEはERBで代入不可の変数です
	ITEMSALESでキャラの未既判断を判定
	
	ITEMPRICE(キャラの固有番号 + 199)、ITEMSALES:(キャラの固有番号 + 199)に格納されている
		例）미카즈키 무네치카ならITEMPRICE:(3 + 199) == 40000となる
	
	特キャラの場合　ITEMPRICEにITEM.csvで定義した値	ITEMSALESが1
    극キャラの場合　ITEMPRICEに0					ITEMSALESが2
    	特の特定キャラが購入可能か調べる場合は「IF ITEMSALES:(キャラの固有番号 + 199) == 1」で判定すればよい
    		※「IF ITEMPRICE:(キャラの固有番号 + 199)」で判定すると、キャラが購入済みの場合もTrueになる
    	극の特定キャラが入손済みか調べる場合は「IF ITEMSALES:(キャラの固有番号 + 199) == 2」で判定すればよい
    		※극キャラの場合はITEMSALES:(キャラの固有番号 + 199) = 1になることはない
    
--------------------
2.アイテム関連
・アイテムを200種まで拡張
	0-199までアイテムの番号として使用できるようになりました
		できるようにしただけで、何かを実装したわけではないです

・キャラ数を800まで拡張
	文字通り0-799までキャラの固有番号として使えるようになりました
	※キャラもアイテムとして数えているようなので
	　アイテム数0-999の1000個＝アイテム番号（アイテム）0-199の200個＋アイテム番号（キャラ）200-999の800個
	　以上より、キャラ数は800まで拡張となりました
			アイテム数の上限はVariableSize.csvのITEMで決まってます（現在1000）
	※該当キャラのアイテム番号 = キャラ固有番号 + 199

--------------------
3.個体差・素質関連

・個体差の概念を導入
	C둔감　C민감といった素質があるのに活用されていないのはもったいないと感じたため実装しました
		とはいえCSVで設定するのは気が引けたため、ランダムで付与という形になりました
	デフォルトでは個体差はオフです
		コンフィグから各々の好みに沿ってオンしてください
	付与された素質はCFLAG:4で記録しています
		あくまでも個体差で付与された素質のみを記録して、CSVで設定されているものは記録しません
		ただし、重複して記録される場合もあります
			例：CSVで포경が設定されているキャラが個体差によって포경を得た場合
	되감기약を使った場合も、個体差で付与された素質は同じものが付け直されます
	個体差関連の処理は「DIFFERENCE.ERB」にまとめてます
	
	※個体差オプションの「CSVの素質優先」項目について
		「CSVの素質優先」の選択肢→個体差なし／CSVの素質優先／個体差優先
		
		個体差なし
			個体差によって素質が付与されません。CSVの素質のままキャラが追加されます
			デフォルトではこれが選択されています

		CSVの素質優先
			【소인체형/작은체구/큰체구/술꾼/알콜쓰레기/아이사이즈/단소/포경/요리치/요리고수】が
			CSVで設定されている場合はそちらが優先されて、相反する素質がつくことがないです
				소인체형←→작은체구←→（ふつう）←→큰체구
				술꾼←→알콜쓰레기
				아이사이즈←→단소←→（ふつう）/거근/말자지　　※거근/말자지がCSVで設定されているキャラは現状いない
				포경←→포경なし
				요리치←→요리고수
				
				例：CSVの素質優先を選択している場合、CSVで소인체형が設定されている이마노츠루기は
				　・작은체구を持つ個体
				　・소인체형を持たない個体（ふつうサイズの個体）
				　・큰체구を持つ個体
				　になる可能性はない

		個体差優先
			CSVの素質優先と逆で、
			【소인체형/작은체구/큰체구/술꾼/알콜쓰레기/아이사이즈/단소/포경/요리치/요리고수】が
			CSVで設定されていても、相反する素質が付く可能性があります
			相反する素質が付いた場合は、元の素質は削除されます
			
			例：個体差優先を選択している場合、CSVで소인체형が設定されている이마노츠루기は
			　・작은체구を持つ個体
			　・소인체형を持たない個体（ふつうサイズの個体）
			　・큰체구を持つ個体
			　になる可能性がある

・컨트보이
	가슴がない　페니스がない　바기나がある
	男か女かで言うと、男性になります
		（후타나리を見る限り）가슴の有無で男女を区別しているようなので男性扱いです
	반음반양と同様に子宮がありません
		挿入子宮입責めやら挿入Ｇスポ責めなどはできません
		前立腺はあります

・쉬메일
	가슴がある　페니스がある　바기나がない
	男か女かで言うと、女性になります
		（후타나리を見る限り）가슴の有無で男女を区別しているようなので女性扱いです
	후타나리と同様に前立腺と金玉がありません
		前立腺刺激などはできません

・오메가
	오메가バースの오메가です
		アルファやベータはありません
		番もありません（現状）
	남자・반음반양・컨트보이がＡで임신できるようになります
	발정기があります
		발정기を抑える薬はありません　eraの意味がないので
	一度付与すると外せません
	主人か助손が금지된지식を持っていないと付与できません
		個体差で得た場合は別
	オンナ・후타나리・쉬메일にも素質付与が可能
		この場合、Ａ임신はできません
			ＡとＶ両方で임신は処理どうすればいいかわからなかったので実装してません
				両方で임신できるようにするなら、
				CFLAG:108(避妊結界の効果発動中フラグ)を子宮用と애널用で分ける必要がありそうです
					ほかにもいじる箇所はあると思います
	공にも素質付与が可能
		この場合、突っ込むのも突っ込まれるのもできないキャラが誕生します
			特定キャラの貞操管理や種管理がしたい場合は便利かもしれません？

・발정기
	윤활・욕정・굴복(未陥落の場合は억울も)を感じやすく、고통を感じにくくなります
		感度にはパフもデバフもかかりません
	체력の回復量が少ない、日常イベントに登場不可、労役の一部が制限などのデメリットがあります
		日常イベントは地の文分岐の数がすごく多くなりそうなので断念しました
	미약とは別で判定しているので、발정기＆미약の場合は二重に効果がかかります

・혀놀림
	取得イベントを追加
		せっかく素質があるのに、CSVで設定されているキャラもいないのはもったいないと感じたため
		取得条件はEVENT_A.ERBやヘルプを参照

・술꾼　알콜쓰레기
	実装したくなったため実装しました
	現状、꽐라플레이（후述）でしか使われていません
		夜イベントの酒宴イベントなどでも活用できそう？

・함몰유두
	実装したくなったため実装しました
	PALAM:욕정が３未満だとＢ感度にB둔감並みにデバフ　３以上だとB민감並みにバフがかかります

--------------------
4.극関連
・全体的なイメージ
	극男士は、同一の特の男士が修行し、帰還しているイメージです
	そのため、特の頃の経験や能力を引き継ぎます
		例：연모陥落した三日月を修行に出して、帰ってきた三日月　극は연모陥落
	どんな修行しているかは各々のイメージで補完してください

・仕様など
	以下のすべて条件を満たせば「労役指示（本丸）」から修行に出せます
		극キャラのCSVが存在する
			※ニューゲームにしないと、CSVが存在すると認識してくれない場合があります
		助손可能、もしくは共犯者
		극でない
		該当男士の극を所持していない・過去にも所持していない
		달마、임신、붕괴、실의、광기のいずれかでない
		후天的な유아／유아퇴행でない
		체력が1000以上
		誰かが修行中でない
		該当男士が他の労役中でない
		昼であること
			
		※一部欠損は修行可能で、달마は不可とか大分ガバガバだとは思うので
		　その他諸々好みでいじってください
		　WORK_HONMARU.ERBに書いてあります
		　
		※「該当男士の극を所持していない・過去にも所持していない」条件について
		　例：審神者と三日月のみいる本丸
		　→三日月を修行へ
		　→三日月　극の帰還
		　→三日月の購入
		　	この三日月は修行へ出せません
		　		同じ固有番号のキャラの同時所有が現状できないためです
		　	三日月　극を売却していても同様に修行へ出せません
		　		売却時に他キャラの面識フラグなどがリセットされない仕様なので、この辺を考えると出せないとするのが自然？
		　			リセットするようにすれば同時所持でない限りは可能かもしれません
		　				そもそも、面識フラグなどを固有番号の記録でなく、ID的なものを記録するように変更すれば
		　				同時所有も可能な気がします
		　					손間がかかるのが予想できるのでやりたくないですが

	修行へ出すと4日후に극キャラとなって帰還します
		帰還するまでは特キャラとして扱われます
	素質は극のものに上書きされます
		후天的に得た素質・個体差で得た素質はそのまま保持します
	극キャラ帰還후は、特キャラを再度購入できます
		その場合はCSVのデフォルトのキャラです
			ボーナスなどはないです
			個体差の素質はコンフィグオンにしてたら付与されます
	
	修業出発時・帰還時の입上は特キャラのものを呼びます
		支障があるようなら극キャラの입上（もしくは両方）を呼ぶように変えます
	それ以降は극キャラの입上を呼びます

・処理
	特の固有番号に극の固有番号を代入することで극キャラにしてます
		ADDCHARAしてません
		登録番号は変わりません
	名前、あだ名、素質、도종フラグのみ극キャラのもので上書きします
		それ以外は特キャラのものをそのまま使います
	他キャラから面識フラグや助손経験フラグなどは、ずらしたり上書きして辻褄を合わせます
	特と극キャラ同時に存在してる瞬間はありません
		帰還直후に特と극を比較して何かしたい場合はCSVで判定するか、극のCFLAG見るなどしてください

・衣装設定など
	特の衣装設定と同様に防具は基本的に無視しています
	CLOTHES2.ERBの衣装設定が長くなり過ぎる箇所は、特と극を別々の行に分けて書いています

--------------------
5.コマンド関連
・꽐라플레이
	実装したくなったため実装しました
	감주・맥주・사케を飲ませられます
		アイテムを所持している必要があります
	윤활と욕정を感じやすくなります
	感度にデバフ　굴복　습득　불쾌を感じにくくなります
	飲ませすぎると吐きます
		このためにBASE:구역질を実装しました　趣味です
		술꾼だと吐きにくく、알콜쓰레기だと吐きやすくなっています
	ここに書いて気づきましたが、ほぼデメリットしかない気がします
		おいおい調整します

--------------------
6.内番関連
・全体的なイメージ
	손合わせがあるなら畑当番・馬当番があってもいいと思ったため実装しました
	とりあえず処理作って動くようにしただけで、ほぼ得るものはないです
		地の文分岐を作るのが次の目標
	開始時終了時に입上呼びます

・畑当番
	체력の最大値が確定で上昇します
	습득の珠と부정の珠を取得します

・馬当番
	기력の最大値が確定で上昇します
	습득の珠と굴복の珠と부정の珠を取得します

--------------------
7.입上関連
・私家改造版に伴う変更箇所など
　変更箇所はフラグ表に反映済みのため、そちらを見たほうが早いです
　増えた입上テンプレなどは입上について.txtを参照してください

※全部は書いていません　입上制作に関係ありそうなものをピックアップしています
※思い出したら増えます

	조교경험フラグ　CFLAG:1099～2098 = キャラ番号+1099

	面識フラグ　CFLAG:2099～3098 = キャラ番号+2099

	CFLAG:102→CFLAG:101に移動、かつ保持内容を変更
		どっちで誰に임신させられたかを保持できるようになっています

	CFLAG:702-705　の追加
		その調教、労役などで腸射されたカウントを保持
		※膣射はCFLAG:102-105に保持

--------------------
8.その他
・夜イベントの３Ｐについて
	私家改造版にあたって、全体的に処理を書き直してます
		条件などは変更してないはず
	夜３Ｐで、膣射・腸射された場合は질내사정경험・장내사정경험はカウントされますが
	これらの膣射・腸射で임신はしません
		CFLAG:102-104およびCFLAG:702-704に回数を발していないためです
			そもそも誰に膣射・腸射されたか判別できないため、回数を발せない状態
				処理中にTARGETやMASTER、ASSIと書かれていますが
				夜イベントだと、実際の現在の調教対象や主人、助손と必ずしも一致していません
					夜イベント開始時に
					夜イベントのメインターゲット(=TARGETに代入されるキャラ)と
					サブターゲット(=ASSIに代入されるキャラ)と
					主人(=MASTERに代入されるキャラ)がそれぞれ判定、代入されてます
						主人も必ずしも現在の主人が代入されるわけではなく、
						メインターゲットに思慕畏怖対象がいた(かつ、それが現在の主人でない)場合などは
						別のキャラが代入されていることがあります
	
	ちなみに、朝イベントの３Ｐは突っ込まないプレイに変更したため
	そもそも膣射・腸射が起こりません
	
	どうでもいいですが、夜イベント３Ｐ書き直すにあたって
	POSITION(ARG)：Ｖ수・Ａ수・挿入のどれが可能か判定する関数
	PRIORITY_POSITION(ARG)：Ｖ수・Ａ수・挿入のどれを優先するか判定する関数
	とか作ったのでよければ使ってください
		COMMON.ERBにあります
			使い道は色々あるはず
				Ｖ수・Ａ수・挿入可能の基準むちゃくちゃ主観ですが…


--------------------
9.更新に伴うバグ修正の補발
ver0.4更新
・意図しない条件で이상경험を발されていたのを修正(COMF366_촉수바기나확장.ERB)
	촉수바기나확장コマンドで
	「V확장경험がなかった場合に이상경험+1」する処理とは別に
	「奴隷のV경험がなかった場合、PLAYERが남자でないときに이상경험+1」する処理が入っていましたが、削除しました
		他のバリアントでも同様の処理になっていたので、もしかしたら意味があるのかもしれませんが、
		イマイチ意図が分からなかったため削除
			あえて解釈するなら
			「Ｖ持ちのPLAYERが、奴隷の開発してないＶに극太촉수を突っ込むのが異常」という感じだったんでしょうか？
	(ver0.6更新)촉수양구멍확장コマンドの同様の記載を削除しました

・실금버릇とか絶頂放尿関連の処理を調整(TRACHECK.ERB)
	以下のように仕様と処理の変更
		「いずれかの場所で絶頂していると我慢しづらくなる」
		→「공포のパラメータに応じて、我慢しづらくなる」「욕정のパラメータに応じて、我慢しづらくなる」
		
		「실금버릇持ちは、いずれかの場所で絶頂していたら放尿処理を呼ぶ」
		→「실금버릇持ちは、通常のキャラの3分の2ほど我慢できる　それ以上はランダムで放尿処理を呼ぶ」
	
	放尿時の地の文の条件を微修正

	細かな説明
		「실금버릇持ちは、いずれかの場所で絶頂していたら放尿処理を呼ぶ」は
		具体的には、「실금버릇持ちで、뇨의が0以上、かつ(A/B/C/Dのいずれかが0以上)なら放尿処理を呼ぶ」という処理でした
			※一文字変数A/B/C/Dには、A/B/C/Vでの絶頂強度(A=2ならAで強絶頂)が格納されている(はずだった)
			※素質にかかわらず、뇨의の初期値は10
		
		確かに、(元々の)仕様を満たす処理として正しいかったのですが、
		どうやら調教開始時かコマンド実行時に、A/B/C/Dの一文字変数に、絶頂の強度ではない別の値が代入されていたようで、
		실금버릇持ちは、調教開始１回目のコマンド実行時に確定で放尿してしまうバグがありました
			同様の原因で、실금버릇持ちに이뇨제盛ったときも、次のコマンド実行時に確定で放尿していました
		
		しかしバグを解消したところ、元々の仕様がどうしても満たせなくなり、該当の仕様と処理を変更しました
		
		※補발
			뇨의やら絶頂やらの処理順　(SOURCE.ERBを参考)
				1.コマンド実行時の뇨의上昇
					뇨의60ないと上昇しない
				2.뇨의のチェック　@DEFECATION_CHECK　(素質やパラメータによる뇨의の上昇)
					一定以上の뇨의があるか、絶頂放尿フラグTFLAG:68が立っていると放尿処理へ
						※以前の処理だと、ここで一文字変数A/B/C/Dを参照していた
						　一体何の値を参照していたんだろう…
				3.絶頂チェック　@ORGASM_ADD_CHECK
					おそらくここで一文字変数A/B/C/Dに、A/B/C/Vでの絶頂の強度が格納される
				4.絶頂処理　@ORGASM_ADD
					一文字変数A/B/C/Vの合計値がTFLAG:29に代入される
				5.絶頂放尿処理　@ORGASM_ADD_URINE
					TFLAG:29が立っていたら、TFLAG:68を立たせる
				5.放尿時の地の文や입上
					TFLAG:68が立っていると呼ばれる
			
			上の処理順を考慮してバグを解消すると、元々の仕様がどうしても満たせなくなり、変更しました
		
		※蛇발
			SOURCE.ERBの処理順を、絶頂チェックしてから뇨의のチェックをするように変更する案も思いつきましたが
			放尿時の쾌Cのソースが処理されなくなるため、やめました
			

