;-------------------------------------------------
;夜に起こるイベント
;eratohoYMからの移植と調教者変更機能・수공フィルタ等に対応した改造です
;-------------------------------------------------
@EVENT_NIGHT_SELF
;夜に起こるイベント。
;使う変数を０にしておく
REPEAT FLAG:44
	W:COUNT = 0
REND
G = -1
D = -1
I = 0
;0|主人以外と夜イベント 1|主人によるNTRイベント 2|覗き見好きな人 3|酒宴ランダム値4|음란３ｐフラグ
K:0 = 0
K:1 = 0
K:2 = 0
K:3 = 0
K:4 = 0
;Ｍ、Ｓのプレイの種類
K:5 = 0
;NTRイベントで好きな人
U = -1

;MASTER、TARGET、ASSIを退避
TFLAG:402 = MASTER
TFLAG:403 = TARGET
TFLAG:404 = ASSI
;発生したイベントを記録
TFLAG:405 = 0

ASSI = -1

;所持キャラ全員に発動チェック
X = 0

;基礎値10から判定開始
B = 10

;主人による判定値ボーナス計算
;수수께끼의매력
SIF TALENT:MASTER:수수께끼의매력
	B += 10
;매혹
SIF TALENT:MASTER:매혹
	B += 5

;キャラ登録数が1以下の時は引き返す
SIF CHARANUM < 1
	RETURN 0
CALL NIGHT_CHECK2

;8%の確率で強制的に誰も来ない。
SIF R >= 92
	RETURN 0
;全員チェックして実行者0人なら終了
SIF X == 0
	RETURN 0
;夜イベントキャンセルフラグが立ってる場合は終了
SIF FLAG:180 == 1
	RETURN 0

;実行対象者が２人以上だったら２人選択 Gがメインターゲット、Dがサブターゲット
IF X >= 2
	REPEAT 2
		E = RAND:X
		TARGET = W:E
		;サブターゲット
		IF COUNT == 0
			D = TARGET
		;メインターゲット
		ELSE
			G = TARGET
		ENDIF
	REND
ELSEIF X == 1
	TARGET = W:0
ENDIF
;メインとサブが別だったらサブを助손に突っこむ、同じだったらDを消しておく
IF TARGET != D
	ASSI = D
ELSE
	D = -1
	ASSI = -1
ENDIF

CALL NIGHT_CHECK

;もしEが0になってしまっている場合は強制終了
SIF E == 0
	RETURN 0

;この数値でメインターゲットの積극値がわかる
SIF TALENT:MASTER:천리안
	PRINTFORML %CALLNAME%の積극値：{E}
R = TARGET
CALL MASTER_SEARCH
;メインターゲットに現在の主人以外の연모・畏怖対象が居るとき
IF N > -1 && M != NO:MASTER
	R = M
	M = NO2(R)
	IF M != -1
		MASTER = M
			U = M
		;思慕・畏怖対象が労役中
		SIF CFLAG:MASTER:12 > 0
			RETURN 0
		;思慕・畏怖対象にイベントキャンセルフラグが立っている
		SIF CFLAG:MASTER:42 > 0
			RETURN 0
		SIF MASTER == ASSI
			ASSI = -1
			K:0 = 1
		;メインターゲットが現主人の연모・畏怖対象だった時、途中で引き留めてNTRプレイ
		R = TFLAG:402
		CALL MASTER_SEARCH
		IF N > -1
			IF M == NO:TARGET && CFLAG:R:40 > 0
				K:1 = 1
				MASTER = TFLAG:402
			ENDIF
		ENDIF
	ENDIF
ENDIF

;メインとサブの연모畏怖対象が同じ時かサブが음란
IF ASSI > -1
	R = ASSI
	CALL MASTER_SEARCH
	IF N > -1 && CFLAG:R:40 > 0
		;好きな人は主人
		SIF M == NO:MASTER
			K:2 = 1
		;好きな人はメインターゲット
		SIF M == NO:TARGET
			K:2 = 2
	ENDIF
	;３Ｐフラグ
	SIF TALENT:ASSI:음란 || TALENT:ASSI:창부
		K:4 += 1
ENDIF
V = 0
;バージン判定(一応백버진、동정も勝손に失わないようにしてみた)
SIF TALENT:처녀 || TALENT:처녀 || TALENT:백버진 || TALENT:MASTER:동정
	V = 1
M = 0
;主人バージン判定
SIF TALENT:MASTER:처녀 || TALENT:MASTER:재생처녀 || TALENT:MASTER:백버진 || TALENT:동정
	M = 1
P = 0
;主人の精力判定
SIF CFLAG:MASTER:11 && PENIS(MASTER)
	P = 1
S = 0
;奴隷の精力判定
SIF CFLAG:TARGET:11 && PENIS(TARGET)
	S = 1
IF ASSI > -1
	;助손の精力判定
	SIF CFLAG:ASSI:11 && PENIS(ASSI)
		V:12 = 1
ENDIF

;소인체형・유치・幼児退行だと添い寝しやすくなる
SIF TALENT:소인체형 || TALENT:유아／유아퇴행 || TALENT:유치
	K:3 = 4

I = RAND:8

;四分の一で主人が寝ている
IF I < 2
	CALL NIGHT_SELF_SLEEP
;陥落している
ELSEIF TALENT:연모 || TALENT:음란 || TALENT:복종 || TALENT:친애 || TALENT:창부 || TALENT:예속
	;NTR
	IF K:1
		CALL NIGHT_SELF_NTR
	;積극値一定以上
	ELSEIF E >= 40
		;체력が低いときは添い寝に
		IF BASE:체력 < 500
			CALL NIGHT_SELF_SOINE
		;연모のとき酒宴と添い寝、아이だと添い寝になりやすい
		ELSEIF (TALENT:연모 || TALENT:친애) && RAND:3 == 0
			IF I < (3+K:3)
				CALL NIGHT_SELF_SOINE
			ELSE
				CALL NIGHT_SELF_DRINK
			ENDIF
		;마조持ちか마조끼高いか복종
		ELSEIF (TALENT:마조 || ABL:마조끼 >= 4 || TALENT:복종 || TALENT:예속) && RAND:4 == 0
			CALL NIGHT_SELF_MPLAY
		;새드持ちか새드끼高い
		ELSEIF (TALENT:새드 || ABL:새드끼 >= 4) && RAND:3 == 0
			CALL NIGHT_SELF_SPLAY
		;모유
		ELSEIF (ABL:착유중독 > 0 && TALENT:모유체질) && RAND:4 == 0
			CALL SELF_CHECK4
		;3P
		ELSEIF (K:2 || K:4) && (TEQUIP:속옷（아래） != 5 && TEQUIP:ASSI:속옷（아래） != 5) && RAND:2 == 0
			CALL NIGHT_SELF_3P
		;当てはまらない
		ELSEIF RAND:4 >= 1
			IF ((M == 0 && S) && ((TALENT:MASTER:수 || TALENT:MASTER:오메가 || TALENT:MASTER:공 == 0) || (TALENT:공 || TALENT:수 == 0 || TALENT:오메가 == 0))) || ((V == 0 && P) && ((TALENT:MASTER:공 || TALENT:MASTER:수 == 0 || TALENT:MASTER:오메가 == 0) || (TALENT:수 || TALENT:오메가 || TALENT:공 == 0)))
				;奴隷が공又は主人が수か오메가
				IF TALENT:공 || TALENT:MASTER:수 || TALENT:MASTER:오메가
					;かつ主人が공又は奴隷が수か오메가
					;主人バージン判定、奴隷の精力判定
					IF M == 0 && S
						;夜這い主人수
						CALL SELF_CHECK8
					ENDIF
				ELSEIF TALENT:수 || TALENT:오메가 || TALENT:MASTER:공
					IF V == 0 && P
						;夜這い
						CALL SELF_CHECK6
					ENDIF
				ELSE
					L:1 = RAND:5
					IF L:1 == 0 && M == 0 && S
						;夜這い主人수
						CALL SELF_CHECK8
					ELSEIF V == 0 && P
						;夜這い
						CALL SELF_CHECK6
					ENDIF
				ENDIF
			ELSE
				;レズプレイ
				CALL NIGHT_SELF_LES
			ENDIF
		ENDIF
	ELSEIF RAND:3 >= 1
		;자위
		CALL SELF_CHECK5
	ENDIF
;정조무관심か여자좋아・남자좋아・아이좋아・섹스중독の条件に当てはまり、積극値40以上
ELSEIF E >= 40 && RAND:3 >= 1 && (ABL:섹스중독 || TALENT:정조무관심 || (TALENT:여자좋아 && MALE(MASTER) == 0 && TALENT:MASTER:소인체형 == 0) || (TALENT:남자좋아 && MALE(MASTER) && TALENT:MASTER:소인체형 == 0) || (TALENT:아이좋아 && TALENT:MASTER:소인체형))
	IF ((M == 0 && S) && ((TALENT:MASTER:수 || TALENT:MASTER:오메가 || TALENT:MASTER:공 == 0) || (TALENT:공 || TALENT:수 == 0 || TALENT:오메가 == 0))) || ((V == 0 && P) && ((TALENT:MASTER:공 || TALENT:MASTER:수 == 0 || TALENT:MASTER:오메가 == 0) || (TALENT:수 || TALENT:오메가 || TALENT:공 == 0)))
		;奴隷が공又は主人が수か오메가
		IF TALENT:공 || TALENT:MASTER:수 || TALENT:MASTER:오메가
			;かつ主人が공又は奴隷が수か오메가
			;主人バージン判定、奴隷の精力判定
			IF M == 0 && S
				;夜這い主人수
				CALL SELF_CHECK8
			ENDIF
		ELSEIF TALENT:수 || TALENT:오메가 || TALENT:MASTER:공
			IF V == 0 && P
				;夜這い
				CALL SELF_CHECK6
			ENDIF
		ELSE
			L:1 = RAND:5
			IF L:1 == 0 && M == 0 && S
				;夜這い主人수
				CALL SELF_CHECK8
			ELSEIF V == 0 && P
				;夜這い
				CALL SELF_CHECK6
			ENDIF
		ENDIF
	ELSE
		;レズプレイ
		CALL NIGHT_SELF_LES
	ENDIF
ELSEIF RAND:3 >= 1
	;자위
	CALL SELF_CHECK5
ENDIF
IF ASSI > -1
	ASSI = TARGET
	TARGET = D
	CALL NIGHT_CHECK
	;覗き見
	SIF TFLAG:405 && E >= 40 && RAND:2 == 0
		CALL NIGHT_SELF_PEEP
ENDIF
DRAWLINE

;-----------------------------------------------
;積극性のチェック関数。ランダム検索しない場合は下ではなくこちらの関数を使います
@NIGHT_CHECK
E = 20

;연모
SIF TALENT:연모
	E += 10
;친애
SIF TALENT:친애
	E += 20
;음란
SIF TALENT:음란
	E += 20
;창부
SIF TALENT:창부
	E += 30
;복종
SIF TALENT:복종
	E -= 10
;예속
SIF TALENT:예속
	E -= 20
;순종
	E += (ABL:순종*ABL:순종)
;순종5以上でボーナス
SIF ABL:순종 >= 5
	E += 15
;순종8以上でボーナス
SIF ABL:순종 >= 8
	E += 5
;순종10でボーナス
SIF ABL:순종 == 10
	E += 10
;욕망
	E += (ABL:욕망*ABL:욕망)
;욕망5以上でボーナス
SIF ABL:욕망 >= 5
	E += 15
;욕망8以上でボーナス
SIF ABL:욕망 >= 8
	E += 10
;욕망10でボーナス
SIF ABL:욕망 == 10
	E += 15
;禁欲ポイントでボーナス
SIF CFLAG:602 >= 50
	E += 5
;禁欲ポイントでボーナス
SIF CFLAG:602 >= 100
	E += 15
;禁欲ポイントでボーナス
SIF CFLAG:602 >= 300
	E += 30
;겁쟁이
SIF TALENT:겁쟁이
	TIMES E , 0.85
;반항적
SIF TALENT:반항적
	TIMES E , 0.80
;솔직함
SIF TALENT:솔직함
	TIMES E , 1.15
;얌전함
SIF TALENT:얌전함
	TIMES E , 0.90
;감정부족
SIF TALENT:감정부족
	TIMES E , 0.60
;무관심
SIF TALENT:무관심
	TIMES E , 0.30
;호기심
SIF TALENT:호기심
	TIMES E , 1.10
;보수적
SIF TALENT:보수적
	TIMES E , 0.90
;낙관적
SIF TALENT:낙관적
	TIMES E , 1.10
;일선을넘지않음
SIF TALENT:일선을넘지않음
	TIMES E , 0.80
;정조관념（陥落前のみ）
SIF TALENT:정조관념 && TALENT:연모 == 0 && TALENT:음란 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:창부 == 0 && TALENT:예속 == 0
	TIMES E , 0.50
;정조무관심（陥落前のみ）
SIF TALENT:정조무관심 && TALENT:연모 == 0 && TALENT:음란 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:창부 == 0 && TALENT:예속 == 0
	TIMES E , 1.20
;억압
SIF TALENT:억압
	TIMES E , 0.75
;해방
SIF TALENT:해방
	TIMES E , 1.10
;부끄럼쟁이
SIF TALENT:부끄럼쟁이
	TIMES E , 0.85
;수치심없음
SIF TALENT:수치심없음
	TIMES E , 1.10
;쾌감에솔직
SIF TALENT:쾌감에솔직
	TIMES E , 1.20
;쾌감을부정
SIF TALENT:쾌감을부정
	TIMES E , 0.60
;발정기
SIF TALENT:발정기
	TIMES E , 1.20
;남자혐오（陥落前のみ）
SIF TALENT:남자혐오 && TALENT:연모 == 0 && TALENT:음란 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:창부 == 0 && TALENT:예속 == 0 && MALE(MASTER)
	TIMES E , 0.50
;여자혐오（陥落前のみ）
SIF TALENT:여자혐오 && TALENT:연모 == 0 && TALENT:음란 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:창부 == 0 && TALENT:예속 == 0 && MALE(MASTER)
	TIMES E , 0.50
;여자좋아（陥落前・음란のみ）
SIF TALENT:여자좋아 && TALENT:연모 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:예속 == 0 && MALE(MASTER) == 0 && TALENT:MASTER:소인체형 == 0
	TIMES E , 1.20
;남자좋아（陥落前・음란のみ）
SIF TALENT:남자좋아 && TALENT:연모 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:예속 == 0 && MALE(MASTER) && TALENT:MASTER:소인체형 == 0
	TIMES E , 1.20
;아이좋아（陥落前・음란のみ）
SIF TALENT:아이좋아 && TALENT:연모 == 0 && TALENT:복종 == 0 && TALENT:친애 == 0 && TALENT:예속 == 0 && TALENT:MASTER:소인체형
	TIMES E , 1.20
;思慕・畏怖対象が現在の主人
R = TARGET
CALL MASTER_SEARCH
IF N > -1
	SIF M == NO:MASTER && CFLAG:40 > 0
		TIMES E , 1.20
ENDIF
;반발각인２以上
SIF MARK:반발각인 >= 2
	TIMES E , 0.50

;対象が욕망LV3未満、순종LV0だとダメ
SIF ABL:욕망 < 3 || ABL:순종 < 1
	E = 0
;調教した事がない＋好感度が0のキャラはダメ(반발あっても許さない)
SIF CFLAG:120 == 0 && CFLAG:2 == 0
	E = 0
;イベントキャンセルフラグが立ってるときはだめ
SIF CFLAG:42
	E = 0
;반발각인3も駄目
SIF MARK:반발각인 == 3
	E = 0
;対象が”あなた”だとだめ
SIF NO:TARGET == 0
	E = 0
;기절していると駄目
SIF TALENT:기절
	E = 0

;積극性のチェック関数2
@NIGHT_CHECK2
REPEAT CHARANUM
	;実行者が100人に達したらREPEAT脱出
	SIF X == 100
		BREAK
	;対象が主人ならスキップ
	SIF COUNT == MASTER
		CONTINUE
	;対象が"あなた"だとだめ
	SIF NO:COUNT == 0
		CONTINUE
	;対象が共犯者ならスキップ
	SIF CFLAG:COUNT:1 == 3
		CONTINUE
	;イベントキャンセルフラグが立ってるときスキップ
	SIF CFLAG:COUNT:42
		CONTINUE
	;対象が労役中ならスキップ
	SIF CFLAG:COUNT:12 > 0
		CONTINUE
	;調教した事がない＋好感度が0のキャラはスキップ
	SIF CFLAG:COUNT:120 == 0 && CFLAG:COUNT:2 == 0
		CONTINUE
	;육아중はダメ
	SIF TALENT:COUNT:육아중
		CONTINUE
	;기절していると駄目
	SIF TALENT:COUNT:기절
		CONTINUE
	;対象が욕망LV3未満、순종LV0だとダメ
	;반발각인3も駄目
	IF MARK:COUNT:반발각인 == 3
		CONTINUE
	ELSEIF ABL:COUNT:욕망 < 3 || ABL:COUNT:순종 < 1
		CONTINUE
	ENDIF

	;発動判定値計算
	E = B
	
	;순종
	E += (ABL:COUNT:순종*ABL:COUNT:순종)
	;순종５以上でボーナス
	SIF ABL:COUNT:순종 >= 5
		E += 10
	;욕망
	E += (ABL:COUNT:욕망*ABL:COUNT:욕망)
	;욕망５以上でボーナス
	SIF ABL:COUNT:욕망 >= 5
		E += 10
	;욕망１０でボーナス
	SIF ABL:COUNT:욕망 == 10
		E += 15
	;禁欲ポイントでボーナス
	SIF CFLAG:COUNT:602 >= 50
		E += 5
	;禁欲ポイントでボーナス
	SIF CFLAG:COUNT:602 >= 100
		E += 15
	;禁欲ポイントでボーナス
	SIF CFLAG:COUNT:602 >= 300
		E += 30
	;연모
	SIF TALENT:COUNT:연모
		TIMES E , 1.20
	;친애
	SIF TALENT:COUNT:친애
		TIMES E , 1.30
	;음란
	SIF TALENT:COUNT:음란
		TIMES E , 1.40
	;창부
	SIF TALENT:COUNT:창부
		TIMES E , 1.50
	;복종
	SIF TALENT:COUNT:복종
		TIMES E , 0.75
	;예속
	SIF TALENT:COUNT:예속
		TIMES E , 0.50
	;겁쟁이
	SIF TALENT:COUNT:겁쟁이
		TIMES E , 0.85
	;반항적
	SIF TALENT:COUNT:반항적
		TIMES E , 0.80
	;솔직함
	SIF TALENT:COUNT:솔직함
		TIMES E , 1.15
	;얌전함
	SIF TALENT:COUNT:얌전함
		TIMES E , 0.90
	;감정부족
	SIF TALENT:COUNT:감정부족
		TIMES E , 0.60
	;무관심
	SIF TALENT:COUNT:무관심
		TIMES E , 0.30
	;호기심
	SIF TALENT:COUNT:호기심
		TIMES E , 1.10
	;보수적
	SIF TALENT:COUNT:보수적
		TIMES E , 0.90
	;낙관적
	SIF TALENT:COUNT:낙관적
		TIMES E , 1.10
	;일선을넘지않음
	SIF TALENT:COUNT:일선을넘지않음
		TIMES E , 0.80
	;정조관념（陥落前のみ）
	SIF TALENT:COUNT:정조관념 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:음란 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:창부 == 0 && TALENT:COUNT:예속 == 0
		TIMES E , 0.50
	;정조무관심（陥落前・음란ルートのみ）
	SIF TALENT:COUNT:정조무관심 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:예속 == 0
		TIMES E , 1.20
	;억압
	SIF TALENT:COUNT:억압
		TIMES E , 0.75
	;해방
	SIF TALENT:COUNT:해방
		TIMES E , 1.10
	;부끄럼쟁이
	SIF TALENT:COUNT:부끄럼쟁이
		TIMES E , 0.85
	;수치심없음
	SIF TALENT:COUNT:수치심없음
		TIMES E , 1.10
	;쾌감에솔직
	SIF TALENT:COUNT:쾌감에솔직
		TIMES E , 1.20
	;쾌감을부정
	SIF TALENT:COUNT:쾌감을부정
		TIMES E , 0.60
	;발정기
	SIF TALENT:COUNT:발정기
		TIMES E , 1.20
	;남자혐오（陥落前のみ）
	SIF TALENT:COUNT:남자혐오 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:음란 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:창부 == 0 && TALENT:COUNT:예속 == 0 && MALE(MASTER)
		TIMES E , 0.50
	;여자혐오（陥落前ルートのみ）
	SIF TALENT:COUNT:여자혐오 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:음란 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:창부 == 0 && TALENT:COUNT:예속 == 0 && MALE(MASTER) == 0
		TIMES E , 0.50
	;여자좋아（陥落前・음란ルートのみ）
	SIF TALENT:COUNT:여자좋아 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:예속 == 0 && MALE(MASTER) == 0 && TALENT:MASTER:소인체형 == 0
		TIMES E , 1.20
	;남자좋아（陥落前・음란ルートのみ）
	SIF TALENT:COUNT:남자좋아 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:예속 == 0 && MALE(MASTER) && TALENT:MASTER:소인체형 == 0
		TIMES E , 1.20
	;아이좋아（陥落前・음란ルートのみ）
	SIF TALENT:COUNT:아이좋아 && TALENT:COUNT:연모 == 0 && TALENT:COUNT:복종 == 0 && TALENT:COUNT:친애 == 0 && TALENT:COUNT:예속 == 0 && TALENT:MASTER:소인체형
		TIMES E , 1.20
	;思慕・畏怖対象が現在の主人
	R = COUNT
	CALL MASTER_SEARCH
	IF N > -1
		SIF M == NO:MASTER && CFLAG:COUNT:40 > 0
			TIMES E , 1.20
	ENDIF
	;반발각인２以上
	SIF MARK:COUNT:반발각인 >= 2
		TIMES E , 0.50
	;相性
	R = NO:MASTER
	SIF RELATION:COUNT:R != 0
		E = (E*RELATION:COUNT:R)/100

	;どれだけ高くなっても、その人が行動を起こす可能性は80%
	SIF E > 80
		E = 80

	;この処理があると、どのキャラがどれくらいの確率なのか見ることができます
	SIF TALENT:MASTER:천리안
		PRINTFORML %CALLNAME:COUNT%が行動を起こす確率：{E}％

	;実行判定
	R = RAND:100
	IF R < E
		W:X = COUNT
		X += 1
	ENDIF
REND

;------------------------------------------------------
;退避していた調教者等、調教者変更機能を戻す
@EVENT_NIGHT_AFTER
MASTER = TFLAG:402
TARGET = TFLAG:403
ASSI = TFLAG:404

;------------------------------------------------------
;お酒に誘われる
@NIGHT_SELF_DRINK
;ランダムでほろ酔い・エッチにもつれ込み、酔いつぶれて添い寝
L:2 = RAND:100
IF L:2 < 10 || ((TALENT:소인체형 || TALENT:유아／유아퇴행 || TALENT:유치) && L:2 < 40)
	TFLAG:405 = 2
ELSEIF L:2 > 89 || ((TALENT:음란 || TALENT:창부) && L:2 > 59)
	IF ((M == 0 && S) && ((TALENT:MASTER:수 || TALENT:MASTER:오메가 || TALENT:MASTER:공 == 0) || (TALENT:공 || TALENT:수 == 0 || TALENT:오메가 == 0))) || ((V == 0 && P) && ((TALENT:MASTER:공 || TALENT:MASTER:수 == 0 || TALENT:MASTER:오메가 == 0 ) || (TALENT:수 || TALENT:오메가 || TALENT:공 == 0)))
		;奴隷が공又は主人が수か오메가
		IF TALENT:공 || TALENT:MASTER:수 || TALENT:MASTER:오메가
			;かつ主人が공又は奴隷が수か오메가
			;主人バージン判定、奴隷の精力判定
			IF M == 0 && S
				;夜這い主人수
				TFLAG:405 = 9
			ENDIF
		ELSEIF TALENT:수 || TALENT:오메가 || TALENT:MASTER:공
			IF V == 0 && P
				;夜這い
				TFLAG:405 = 8
			ENDIF
		ELSE
			L:1 = RAND:5
			IF L:1 == 0 && M == 0 && S
				;夜這い主人수
				TFLAG:405 = 9
			ELSEIF V == 0 && P
				;夜這い
				TFLAG:405 = 8
			ENDIF
		ENDIF
	ELSE
		;レズプレイ
		TFLAG:405 = 5
	ENDIF
ENDIF
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 35
CALL KOJO_MESSAGE_EVENT
PRINTW 
IF TFLAG:405 == 2
	CALL NIGHT_SELF_UP_SOINE
ELSEIF TFLAG:405 == 5
	CALL NIGHT_SELF_UP_RES
ELSEIF TFLAG:405 == 8
	CALL NIGHT_SELF_UP_SEME
ELSEIF TFLAG:405 == 9
	CALL NIGHT_SELF_UP_UKE
ELSE
	;大体上がるパラメータは同じっぽいので使い回し
	CALL NIGHT_SELF_UP_SOINE
ENDIF

PRINTW 
;------------------------------------------------------
;添い寝
@NIGHT_SELF_SOINE
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 36
CALL KOJO_MESSAGE_EVENT
PRINTW 
;覗き見用フラグ
TFLAG:405 = 2
;添い寝経験取得呼び出し
CALL NIGHT_SELF_UP_SOINE
PRINTW 

;------------------------------------------------------
;마조プレイ
@NIGHT_SELF_MPLAY
;行うプレイの種類、K:5に記録
L:2 = RAND:100
IF (TALENT:MASTER:마조 || ABL:MASTER:마조끼 >= 4 || TALENT:MASTER:복종 || TALENT:MASTER:예속) && RAND:2 == 0
	K:5 = 4
ELSEIF L:2 > 66 || (ITEM:13 == 0 && L:2 > 49)
	K:5 = 3
ELSEIF L:2 > 33 || (ITEM:13 == 0)
	K:5 = 1
ELSE
	K:5 = 2
ENDIF
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 37
CALL KOJO_MESSAGE_EVENT
PRINTW 
;覗き見用フラグ
TFLAG:405 = 3

S = 1
;마조끼
IF ABL:마조끼 >= 9
	S += 5
ELSEIF ABL:마조끼 >= 7
	S += 4
ELSEIF ABL:마조끼 >= 5
	S += 3
ELSEIF ABL:마조끼 >= 3
	S += 2
ELSEIF ABL:마조끼 >= 1
	S += 1
ENDIF
;主人の새드끼
IF ABL:MASTER:새드끼 >= 9
	S += 5
ELSEIF ABL:MASTER:새드끼 >= 7
	S += 4
ELSEIF ABL:MASTER:새드끼 >= 5
	S += 3
ELSEIF ABL:MASTER:새드끼 >= 3
	S += 2
ELSEIF ABL:MASTER:새드끼 >= 1
	S += 1
ENDIF
;主人の기교
IF ABL:MASTER:기교 >= 9
	S += 5
ELSEIF ABL:MASTER:기교 >= 7
	S += 4
ELSEIF ABL:MASTER:기교 >= 5
	S += 3
ELSEIF ABL:MASTER:기교 >= 3
	S += 2
ELSEIF ABL:MASTER:기교 >= 1
	S += 1
ENDIF
;마조
SIF TALENT:마조
	S += 5
;主人の새드
SIF TALENT:MASTER:새드
	S += 5
;고통쾌락경험、욕정、굴복、고통
PRINTFORML %EXPNAME:30% ＋ {S}
EXP:고통쾌락경험 += S
JUEL:욕정 += S*100
JUEL:굴복 += S*100
JUEL:고통 += S*100
PRINTFORML %PALAMNAME:6%の珠＋{S*100}
PRINTFORML %PALAMNAME:7%の珠＋{S*100}
;채찍打ちのとき고통追加
IF K:5 == 2
	JUEL:고통 += S*50
PRINTFORML %PALAMNAME:10%の珠＋{S*150}
;발舐め・反撃のとき수치追加
ELSEIF K:5 == 3 || K:5 == 4
	JUEL:수치 += S*50
PRINTFORML %PALAMNAME:9%の珠＋{S*50}
ELSE
PRINTFORML %PALAMNAME:10%の珠＋{S*100}
ENDIF
PRINTW 

;------------------------------------------------------
;새드プレイ
@NIGHT_SELF_SPLAY
;行うプレイの種類、K:5に記録
L:2 = RAND:100
IF (TALENT:새드 || ABL:새드끼 >= 4) && RAND:2 == 0
	K:5 = 4
ELSEIF L:2 > 66 || (ITEM:13 == 0 && L:2 > 49)
	K:5 = 3
ELSEIF L:2 > 33 || (ITEM:13 == 0)
	K:5 = 1
ELSE
	K:5 = 2
ENDIF
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 38
CALL KOJO_MESSAGE_EVENT
PRINTW 
;覗き見用フラグ
TFLAG:405 = 4

S = 1
;새드끼
IF ABL:새드끼 >= 9
	S += 5
ELSEIF ABL:새드끼 >= 7
	S += 4
ELSEIF ABL:새드끼 >= 5
	S += 3
ELSEIF ABL:새드끼 >= 3
	S += 2
ELSEIF ABL:새드끼 >= 1
	S += 1
ENDIF
;기교
IF ABL:기교 >= 9
	S += 5
ELSEIF ABL:기교 >= 7
	S += 4
ELSEIF ABL:기교 >= 5
	S += 3
ELSEIF ABL:기교 >= 3
	S += 2
ELSEIF ABL:기교 >= 1
	S += 1
ENDIF
;主人の마조끼
IF ABL:MASTER:마조끼 >= 9
	S += 5
ELSEIF ABL:MASTER:마조끼 >= 7
	S += 4
ELSEIF ABL:MASTER:마조끼 >= 5
	S += 3
ELSEIF ABL:MASTER:마조끼 >= 3
	S += 2
ELSEIF ABL:MASTER:마조끼 >= 1
	S += 1
ENDIF
;새드
SIF TALENT:새드
	S += 5
;主人の마조
SIF TALENT:MASTER:마조
	S += 5
;가학쾌락경험、욕정、습득
PRINTFORML %EXPNAME:32% ＋ {S}
EXP:가학쾌락경험 += S
JUEL:욕정 += S*200
JUEL:습득 += S*100
PRINTFORML %PALAMNAME:6%の珠＋{S*200}
PRINTFORML %PALAMNAME:8%の珠＋{S*100}
PRINTW 

;------------------------------------------------------
;搾乳
@SELF_CHECK4
;イベント입上呼び出し
DRAWLINE
TFLAG:13 = 7
CALL KOJO_MESSAGE_EVENT
PRINTW 
;覗き見用フラグ
TFLAG:405 = 6

;착유중독による搾乳チェック
;모유체질、착유중독、一定能力、체력が必要
M = 1

IF ABL:착유중독 == 1
	M += 1
ELSEIF ABL:착유중독 == 2
	M += 2
ELSEIF ABL:착유중독 == 3
	M += 3
ELSEIF ABL:착유중독 == 4
	M += 5
ELSEIF ABL:착유중독 >= 5
	M += 7
ENDIF
;욕망と봉사정신によるボーナス
IF ABL:욕망 >= 5 && ABL:봉사정신 >= 5 && PALAM:욕정 >= PALAMLV:5
	M += 3
ELSEIF ABL:욕망 >= 4 && ABL:봉사정신 >= 4 && PALAM:욕정 >= PALAMLV:4
	M += 2
ELSEIF ABL:욕망 >= 3 && ABL:봉사정신 >= 3 && PALAM:욕정 >= PALAMLV:3
	M += 1
ENDIF
;자위하기쉬움
SIF TALENT:자위하기쉬움
	M += 2
;음란가슴
SIF TALENT:음란가슴
	M += 3


PRINTFORML %EXPNAME:54%＋{M}
PRINTFORML %PALAMNAME:3%の珠＋{M*300}
PRINTFORML %PALAMNAME:6%の珠＋{M*50}
PRINTFORML %PALAMNAME:8%の珠＋{M*20}
EXP:분유경험 += M
JUEL:쾌B += M*300
JUEL:욕정 += M*50
JUEL:습득 += M*20

IF ABL:순종+ABL:노출벽+ABL:마조끼 >= 10
	PRINTFORML %PALAMNAME:9%の珠＋{M*150}
	JUEL:수치 += M*150
ENDIF

PRINTW 

;------------------------------------------------------
;３Ｐ
@NIGHT_SELF_3P

#DIM DYNAMIC POSITION_MASTER
#DIM DYNAMIC POSITION_TARGET
#DIM DYNAMIC POSITION_ASSI

;主人・メイン・サブがそれぞれＶ・Ａ・挿入　どれを優先するか
POSITION_MASTER = PRIORITY_POSITION(MASTER)
POSITION_TARGET = PRIORITY_POSITION(TARGET)
POSITION_ASSI = PRIORITY_POSITION(ASSI)

;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 43
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
;SIF TEQUIP:속옷（아래） == 5
;	RETURN 0

S = 1
;主人・メイン・サブの욕망を발して平均化
S += (ABL:욕망+ABL:MASTER:욕망+ABL:ASSI:욕망)/3
;음란
SIF TALENT:음란
	S += 1
SIF TALENT:MASTER:음란
	S += 1
SIF TALENT:ASSI:음란
	S += 1
;창부
SIF TALENT:창부
	S += 1
SIF TALENT:MASTER:창부
	S += 1
SIF TALENT:ASSI:창부
	S += 1
;헌신적
SIF TALENT:헌신적
	S += 1
SIF TALENT:MASTER:헌신적
	S += 1
SIF TALENT:ASSI:헌신적
	S += 1
;고무적
SIF TALENT:고무적
	S += 1
SIF TALENT:MASTER:고무적
	S += 1
SIF TALENT:ASSI:고무적
	S += 1
;발정기
SIF TALENT:발정기
	S += 1
SIF TALENT:MASTER:발정기
	S += 1
SIF TALENT:ASSI:발정기
	S += 1

;主人がいずれも不可
IF POSITION_MASTER == 0
	;メインがいずれも不可
	IF POSITION_TARGET == 0
		;挿入がいない
		PRINTFORML 三人に%PALAMNAME:0%＋{S*100}
		PRINTFORML 三人に%PALAMNAME:3%＋{S*100}
		JUEL:쾌C += S*100
		JUEL:MASTER:쾌C += S*100
		JUEL:ASSI:쾌C += S*100
		JUEL:쾌B += S*100
		JUEL:MASTER:쾌B += S*100
		JUEL:ASSI:쾌B += S*100
	;メインがＶ수優先　または　メインがＡ수優先
	ELSEIF POSITION_TARGET == 1 || POSITION_TARGET == 2
		;助손が挿入優先
		IF POSITION_ASSI == 3
			;サブとメインに성교경험
			PRINTFORML %CALLNAME%に%EXPNAME:4%＋{S/2}
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:4%＋{S/2}
			EXP:성교경험 += S/2
			EXP:ASSI:성교경험 += S/2
			;サブに쾌C　삽입경험
			PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:0%＋{S*100}
			JUEL:ASSI:쾌C += S*100
			EXP:ASSI:삽입경험 += S/2
			
			;メインがＶ수優先
			IF POSITION_TARGET == 1
				;쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME%に%PALAMNAME:1%＋{S*100}
				JUEL:쾌V += S*100
				PRINTFORML %CALLNAME%に%EXPNAME:0%＋{S/2}
				EXP:V경험 += S/2
				IF ABLE_SHOOT(ASSI) == 1
					PRINTFORML %CALLNAME%に%EXPNAME:5%＋{S/2}
					EXP:질내사정경험 += S/2
				ENDIF
			;メインがＡ수優先
			ELSEIF POSITION_TARGET == 2
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME%に%PALAMNAME:2%＋{S*100}
				JUEL:쾌A += S*100
				PRINTFORML %CALLNAME%に%EXPNAME:1%＋{S/2}
				EXP:A경험 += S/2
				IF ABLE_SHOOT(ASSI) == 1
					PRINTFORML %CALLNAME%に%EXPNAME:14%＋{S/2}
					EXP:장내사정경험 += S/2
				ENDIF
			ENDIF
			
			;主人に펠라경험
			PRINTFORML %CALLNAME:MASTER%に%EXPNAME:22%＋{S/2}
			EXP:MASTER:펠라경험 += S/2
		;それ以外
		ELSE
			;挿入がいない
			PRINTFORML 三人に%PALAMNAME:0%＋{S*100}
			PRINTFORML 三人に%PALAMNAME:3%＋{S*100}
			JUEL:쾌C += S*100
			JUEL:MASTER:쾌C += S*100
			JUEL:ASSI:쾌C += S*100
			JUEL:쾌B += S*100
			JUEL:MASTER:쾌B += S*100
			JUEL:ASSI:쾌B += S*100
		ENDIF
	;メインが挿入優先
	ELSEIF POSITION_TARGET == 3
		;助손が挿入優先
		IF POSITION_ASSI == 0 || POSITION_ASSI == 3
			;수がいない
			PRINTFORML 三人に%PALAMNAME:0%＋{S*100}
			PRINTFORML 三人に%PALAMNAME:3%＋{S*100}
			JUEL:쾌C += S*100
			JUEL:MASTER:쾌C += S*100
			JUEL:ASSI:쾌C += S*100
			JUEL:쾌B += S*100
			JUEL:MASTER:쾌B += S*100
			JUEL:ASSI:쾌B += S*100
		;助손がＶ수優先　または　助손がＡ수優先
		ELSE
			;サブとメインに성교경험
			PRINTFORML %CALLNAME%に%EXPNAME:4%＋{S/2}
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:4%＋{S/2}
			EXP:성교경험 += S/2
			EXP:ASSI:성교경험 += S/2
			
			;メインに쾌C　삽입경험
			PRINTFORML %CALLNAME%に%PALAMNAME:0%＋{S*100}
			JUEL:쾌C += S*100
			EXP:삽입경험 += S/2
			
			;助손がＶ수優先
			IF POSITION_ASSI == 1
				;쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:1%＋{S*100}
				JUEL:ASSI:쾌V += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:0%＋{S/2}
				EXP:ASSI:V경험 += S/2
				IF ABLE_SHOOT(TARGET) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:5%＋{S/2}
					EXP:ASSI:질내사정경험 += S/2
				ENDIF
				
			;助손がＡ수優先
			ELSEIF POSITION_ASSI == 2
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:2%＋{S*100}
				JUEL:ASSI:쾌A += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:1%＋{S/2}
				EXP:ASSI:A경험 += S/2
				IF ABLE_SHOOT(TARGET) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:14%＋{S/2}
					EXP:ASSI:장내사정경험 += S/2
				ENDIF
			ENDIF
			
			;主人に펠라경험
			PRINTFORML %CALLNAME:MASTER%に%EXPNAME:22%＋{S/2}
			EXP:MASTER:펠라경험 += S/2
		ENDIF
	ENDIF
;主人がＶ수優先　または　主人がＡ수優先
ELSEIF POSITION_MASTER == 1 || POSITION_MASTER == 2
	;メインがいずれも不可　または　メインがＶ수優先　または　メインがＡ수優先
	IF POSITION_TARGET == 0 || POSITION_TARGET == 1 || POSITION_TARGET == 2
		;助손が挿入優先
		IF POSITION_ASSI == 3
			;主人とサブに성교경험
			PRINTFORML %CALLNAME:MASTER%に%EXPNAME:4%＋{S/2}
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:4%＋{S/2}
			EXP:MASTER:성교경험 += S/2
			EXP:ASSI:성교경험 += S/2
			
			;サブに쾌C　삽입경험
			PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:0%＋{S*100}
			JUEL:ASSI:쾌C += S*100
			EXP:ASSI:삽입경험 += S/2
			
			;主人がＶ수優先
			IF POSITION_MASTER == 1
				;主人に쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:1%＋{S*100}
				JUEL:MASTER:쾌V += S*100
				PRINTFORML %CALLNAME:MASTER%に%EXPNAME:0%＋{S/2}
				EXP:MASTER:V경험 += S/2
				IF ABLE_SHOOT(ASSI) == 1
					PRINTFORML %CALLNAME:MASTER%に%EXPNAME:5%＋{S/2}
					EXP:MASTER:질내사정경험 += S/2
				ENDIF
			;主人がＡ수優先
			ELSEIF POSITION_MASTER == 2
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:2%＋{S*100}
				JUEL:MASTER:쾌A += S*100
				PRINTFORML %CALLNAME:MASTER%に%EXPNAME:1%＋{S/2}
				EXP:MASTER:A경험 += S/2
				IF ABLE_SHOOT(ASSI) == 1
					PRINTFORML %CALLNAME:MASTER%に%EXPNAME:14%＋{S/2}
					EXP:MASTER:장내사정경험 += S/2
				ENDIF
			ENDIF
			
			;メインがいずれも不可
			IF POSITION_TARGET == 0 
				;メインに펠라경험
				PRINTFORML %CALLNAME%に%EXPNAME:22%＋{S/2}
				EXP:펠라경험 += S/2
			;メインがＶ수優先　または　メインがＡ수優先
			ELSE
				;メインに성교경험
				PRINTFORML %CALLNAME%に%EXPNAME:4%＋{S/2}
				EXP:성교경험 += S/2
				;メインがＶ수優先
				IF POSITION_TARGET == 1
					;쾌V、V경험、질내사정경험
					PRINTFORML %CALLNAME%に%PALAMNAME:1%＋{S*100}
					JUEL:쾌V += S*100
					PRINTFORML %CALLNAME%に%EXPNAME:0%＋{S/2}
					EXP:V경험 += S/2
					IF ABLE_SHOOT(ASSI) == 1
						PRINTFORML %CALLNAME%に%EXPNAME:5%＋{S/2}
						EXP:질내사정경험 += S/2
					ENDIF
				;メインがＡ수優先
				ELSEIF POSITION_TARGET == 2
					;쾌A、A경험、장내사정경험
					PRINTFORML %CALLNAME%に%PALAMNAME:2%＋{S*100}
					JUEL:쾌A += S*100
					PRINTFORML %CALLNAME%に%EXPNAME:1%＋{S/2}
					EXP:A경험 += S/2
					IF ABLE_SHOOT(ASSI) == 1
						PRINTFORML %CALLNAME%に%EXPNAME:14%＋{S/2}
						EXP:장내사정경험 += S/2
					ENDIF
				ENDIF
			ENDIF
		;それ以外
		ELSE
			;공がいない
			PRINTFORML 三人に%PALAMNAME:0%＋{S*100}
			PRINTFORML 三人に%PALAMNAME:3%＋{S*100}
			JUEL:쾌C += S*100
			JUEL:MASTER:쾌C += S*100
			JUEL:ASSI:쾌C += S*100
			JUEL:쾌B += S*100
			JUEL:MASTER:쾌B += S*100
			JUEL:ASSI:쾌B += S*100
		ENDIF
	;メインが挿入優先
	ELSEIF POSITION_TARGET == 3
		;主人とメインに성교경험
		PRINTFORML %CALLNAME%に%EXPNAME:4%＋{S/2}
		PRINTFORML %CALLNAME:MASTER%に%EXPNAME:4%＋{S/2}
		EXP:MASTER:성교경험 += S/2
		EXP:성교경험 += S/2
		
		;メインに쾌C　삽입경험
		PRINTFORML %CALLNAME%に%PALAMNAME:0%＋{S*100}
		JUEL:쾌C += S*100
		EXP:삽입경험 += S/2
		
		;主人がＶ수優先
		IF POSITION_MASTER == 1
			;主人に쾌V、V경험、질내사정경험
			PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:1%＋{S*100}
			JUEL:MASTER:쾌V += S*100
			PRINTFORML %CALLNAME:MASTER%に%EXPNAME:0%＋{S/2}
			EXP:MASTER:V경험 += S/2
			IF ABLE_SHOOT(TARGET) == 1 || (POSITION_ASSI == 3 && ABLE_SHOOT(ASSI) == 1)
				PRINTFORML %CALLNAME:MASTER%に%EXPNAME:5%＋{S/2}
				EXP:MASTER:질내사정경험 += S/2
			ENDIF
			
		;主人がＡ수優先
		ELSEIF POSITION_MASTER == 2
			;쾌A、A경험、장내사정경험
			PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:2%＋{S*100}
			JUEL:MASTER:쾌A += S*100
			PRINTFORML %CALLNAME:MASTER%に%EXPNAME:1%＋{S/2}
			EXP:MASTER:A경험 += S/2
			IF ABLE_SHOOT(TARGET) == 1 || (POSITION_ASSI == 3 && ABLE_SHOOT(ASSI) == 1)
				PRINTFORML %CALLNAME:MASTER%に%EXPNAME:14%＋{S/2}
				EXP:MASTER:장내사정경험 += S/2
			ENDIF
		ENDIF
		
		;助손がいずれも不可
		IF POSITION_ASSI == 0
			;メインに펠라경험
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:22%＋{S/2}
			EXP:ASSI:펠라경험 += S/2
		;それ以外
		ELSE
			;サブに성교경험
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:4%＋{S/2}
			EXP:ASSI:성교경험 += S/2
			
			;助손がＶ수優先
			IF POSITION_ASSI == 1
				;쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:1%＋{S*100}
				JUEL:ASSI:쾌V += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:0%＋{S/2}
				EXP:ASSI:V경험 += S/2
				IF ABLE_SHOOT(TARGET) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:5%＋{S/2}
					EXP:ASSI:질내사정경험 += S/2
				ENDIF
			;助손がＡ수優先
			ELSEIF POSITION_ASSI
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:2%＋{S*100}
				JUEL:ASSI:쾌A += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:1%＋{S/2}
				EXP:ASSI:A경험 += S/2
				IF ABLE_SHOOT(TARGET) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:14%＋{S/2}
					EXP:ASSI:장내사정경험 += S/2
				ENDIF
			;助손が挿入優先
			ELSEIF POSITION_ASSI == 3
				;サブに쾌C　삽입경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:0%＋{S*100}
				JUEL:ASSI:쾌C += S*100
				EXP:ASSI:삽입경험 += S/2
			ENDIF
		ENDIF
	ENDIF
;主人が挿入優先
ELSEIF POSITION_MASTER == 3
	;メインがいずれも不可
	IF POSITION_TARGET == 0
		;助손がＶ수優先　または　助손がＡ수優先
		IF POSITION_ASSI == 1 || POSITION_ASSI ==2
			;主人とサブに성교경험
			PRINTFORML %CALLNAME:MASTER%に%EXPNAME:4%＋{S/2}
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:4%＋{S/2}
			EXP:MASTER:성교경험 += S/2
			EXP:ASSI:성교경험 += S/2
			
			;主人に쾌C　삽입경험
			PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:0%＋{S*100}
			JUEL:MASTER:쾌C += S*100
			EXP:MASTER:삽입경험 += S/2
			
			;助손がＶ수優先
			IF POSITION_ASSI == 1
				;쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:1%＋{S*100}
				JUEL:ASSI:쾌V += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:0%＋{S/2}
				EXP:ASSI:V경험 += S/2
				IF ABLE_SHOOT(MASTER) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:5%＋{S/2}
					EXP:ASSI:질내사정경험 += S/2
				ENDIF
			;助손がＡ수優先
			ELSEIF POSITION_ASSI == 2
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:2%＋{S*100}
				JUEL:ASSI:쾌A += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:1%＋{S/2}
				EXP:ASSI:A경험 += S/2
				IF ABLE_SHOOT(MASTER) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:14%＋{S/2}
					EXP:ASSI:장내사정경험 += S/2
				ENDIF
			ENDIF
			
			;メインに펠라경험
			PRINTFORML %CALLNAME%に%EXPNAME:22%＋{S/2}
			EXP:펠라경험 += S/2
		ELSE
			;수がいない
			PRINTFORML 三人に%PALAMNAME:0%＋{S*100}
			PRINTFORML 三人に%PALAMNAME:3%＋{S*100}
			JUEL:쾌C += S*100
			JUEL:MASTER:쾌C += S*100
			JUEL:ASSI:쾌C += S*100
			JUEL:쾌B += S*100
			JUEL:MASTER:쾌B += S*100
			JUEL:ASSI:쾌B += S*100
		ENDIF
	;メインがＶ수優先　または　メインがＡ수優先
	ELSEIF POSITION_TARGET == 1 || POSITION_TARGET == 2
		;主人とメインに성교경험
		PRINTFORML %CALLNAME%に%EXPNAME:4%＋{S/2}
		PRINTFORML %CALLNAME:MASTER%に%EXPNAME:4%＋{S/2}
		EXP:성교경험 += S/2
		EXP:MASTER:성교경험 += S/2
		
		;主人に쾌C　삽입경험
		PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:0%＋{S*100}
		JUEL:MASTER:쾌C += S*100
		EXP:MASTER:삽입경험 += S/2
		
		;メインがＶ수優先
		IF POSITION_TARGET == 1
			;쾌V、V경험、질내사정경험
			PRINTFORML %CALLNAME%に%PALAMNAME:1%＋{S*100}
			JUEL:쾌V += S*100
			PRINTFORML %CALLNAME%に%EXPNAME:0%＋{S/2}
			EXP:V경험 += S/2
			IF ABLE_SHOOT(MASTER) == 1 || (POSITION_ASSI == 3 && ABLE_SHOOT(ASSI) == 1)
				PRINTFORML %CALLNAME%に%EXPNAME:5%＋{S/2}
				EXP:질내사정경험 += S/2
			ENDIF
		;メインがＡ수優先
		ELSEIF POSITION_TARGET == 2
			;쾌A、A경험
			PRINTFORML %CALLNAME%に%PALAMNAME:2%＋{S*100}
			JUEL:쾌A += S*100
			PRINTFORML %CALLNAME%に%EXPNAME:1%＋{S/2}
			EXP:A경험 += S/2
			IF ABLE_SHOOT(MASTER) == 1 || (POSITION_ASSI == 3 && ABLE_SHOOT(ASSI) == 1)
				PRINTFORML %CALLNAME%に%EXPNAME:14%＋{S/2}
				EXP:장내사정경험 += S/2
			ENDIF
		ENDIF
		
		;助손がいずれも不可
		IF POSITION_ASSI == 0
			;サブに펠라경험
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:22%＋{S/2}
			EXP:ASSI:펠라경험 += S/2
		ELSE
			;サブに성교경험
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:4%＋{S/2}
			EXP:ASSI:성교경험 += S/2
			
			;助손がＶ수優先
			IF POSITION_ASSI == 1
				;쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:1%＋{S*100}
				JUEL:ASSI:쾌V += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:0%＋{S/2}
				EXP:ASSI:V경험 += S/2
				IF ABLE_SHOOT(MASTER) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:5%＋{S/2}
					EXP:ASSI:질내사정경험 += S/2
				ENDIF
			;助손がＡ수優先
			ELSEIF POSITION_ASSI == 2
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:2%＋{S*100}
				JUEL:ASSI:쾌A += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:1%＋{S/2}
				EXP:ASSI:A경험 += S/2
				IF ABLE_SHOOT(MASTER) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:14%＋{S/2}
					EXP:ASSI:장내사정경험 += S/2
				ENDIF
			;助손が挿入優先
			ELSEIF POSITION_ASSI == 3
				;サブに쾌C
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:0%＋{S*100}
				JUEL:ASSI:쾌C += S*100
			ENDIF
		ENDIF
		
	;メインが挿入優先
	ELSEIF POSITION_TARGET == 3
		;助손がＶ수優先　または　助손がＡ수優先
		IF POSITION_ASSI == 1 || POSITION_ASSI == 2
			;三人に성교경험
			PRINTFORML 三人に%EXPNAME:4%＋{S/2}
			EXP:성교경험 += S/2
			EXP:MASTER:성교경험 += S/2
			EXP:ASSI:성교경험 += S/2
			
			;メイン쾌C　삽입경험
			PRINTFORML %CALLNAME%に%PALAMNAME:0%＋{S*100}
			JUEL:쾌C += S*100
			EXP:삽입경험 += S/2
			
			;主人に쾌C　삽입경험
			PRINTFORML %CALLNAME:MASTER%に%PALAMNAME:0%＋{S*100}
			JUEL:MASTER:쾌C += S*100
			EXP:MASTER:삽입경험 += S/2
			
			;助손がＶ수優先
			IF POSITION_ASSI == 1
				;쾌V、V경험、질내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:1%＋{S*100}
				JUEL:ASSI:쾌V += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:0%＋{S/2}
				IF ABLE_SHOOT(MASTER) == 1 || ABLE_SHOOT(TARGET) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:5%＋{S/2}
					EXP:ASSI:질내사정경험 += S/2
				ENDIF
				EXP:ASSI:V경험 += S/2
			;助손がＡ수優先
			ELSEIF POSITION_ASSI == 2
				;쾌A、A경험、장내사정경험
				PRINTFORML %CALLNAME:ASSI%に%PALAMNAME:2%＋{S*100}
				JUEL:ASSI:쾌A += S*100
				PRINTFORML %CALLNAME:ASSI%に%EXPNAME:1%＋{S/2}
				EXP:ASSI:A경험 += S/2
				IF ABLE_SHOOT(MASTER) == 1 || ABLE_SHOOT(TARGET) == 1
					PRINTFORML %CALLNAME:ASSI%に%EXPNAME:14%＋{S/2}
					EXP:ASSI:장내사정경험 += S/2
				ENDIF
			ENDIF
		;それ以外
		ELSE
			;수がいない
			PRINTFORML 三人に%PALAMNAME:0%＋{S*100}
			PRINTFORML 三人に%PALAMNAME:3%＋{S*100}
			JUEL:쾌C += S*100
			JUEL:MASTER:쾌C += S*100
			JUEL:ASSI:쾌C += S*100
			JUEL:쾌B += S*100
			JUEL:MASTER:쾌B += S*100
			JUEL:ASSI:쾌B += S*100
		ENDIF
	ENDIF
ENDIF

;사정경험　정액경험の処理
;主人が사정
IF ABLE_SHOOT(MASTER) == 1
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:3%＋{S/2}
	;禁欲ポイントを減らす
	CFLAG:MASTER:602 = 0
	;メインが사정
	IF ABLE_SHOOT(TARGET) == 1
		PRINTFORML %CALLNAME%に%EXPNAME:3%＋{S/2}
		;禁欲ポイントを減らす
		CFLAG:602 = 0
		;サブが사정
		IF ABLE_SHOOT(ASSI) == 1
			PRINTFORML %CALLNAME:ASSI%に%EXPNAME:3%＋{S/2}
			;禁欲ポイントを減らす
			CFLAG:ASSI:602 = 0
		ENDIF
		;主人以外の誰かが사정してないと主人に정액경험がつかない
		PRINTFORML %CALLNAME:MASTER%に%EXPNAME:20%＋{S/2}
		EXP:MASTER:정액경험 += S/2
	ENDIF
	PRINTFORML %CALLNAME%に%EXPNAME:20%＋{S/2}
	PRINTFORML %CALLNAME:ASSI%に%EXPNAME:20%＋{S/2}
	EXP:정액경험 += S/2
	EXP:ASSI:정액경험 += S/2
;メインが사정
ELSEIF ABLE_SHOOT(MASTER) == 1
	PRINTFORML %CALLNAME%に%EXPNAME:3%＋{S/2}
	;禁欲ポイントを減らす
	CFLAG:602 = 0
	;サブが사정
	IF ABLE_SHOOT(ASSI) == 1
		PRINTFORML %CALLNAME:ASSI%に%EXPNAME:3%＋{S/2}
		;禁欲ポイントを減らす
		CFLAG:ASSI:602 = 0
		;メイン以外の誰かが사정してないとメインに정액경험がつかない
		PRINTFORML %CALLNAME%に%EXPNAME:20%＋{S/2}
		EXP:MASTER:정액경험 += S/2
	ENDIF
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:20%＋{S/2}
	PRINTFORML %CALLNAME:ASSI%に%EXPNAME:20%＋{S/2}
	EXP:MASTER:정액경험 += S/2
	EXP:ASSI:정액경험 += S/2
;サブが사정
ELSEIF ABLE_SHOOT(ASSI) == 1
	PRINTFORML %CALLNAME:ASSI%に%EXPNAME:3%＋{S/2}
	;禁欲ポイントを減らす
	CFLAG:ASSI:602 = 0
	PRINTFORML %CALLNAME%に%EXPNAME:20%＋{S/2}
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:20%＋{S/2}
	EXP:정액경험 += S/2
	EXP:MASTER:정액경험 += S/2
ENDIF

;------------------------------------------------------
;レズプレイ 突っこまずに乳繰り合うプレイ
@NIGHT_SELF_LES
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 39
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
SIF TEQUIP:속옷（아래） == 5
	RETURN 0

;覗き見用フラグ
TFLAG:405 = 5
;レズプレイ経験取得呼び出し
CALL NIGHT_SELF_UP_RES
PRINTW 
;------------------------------------------------------
;覗き見
@NIGHT_SELF_PEEP
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 40
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
SIF TEQUIP:속옷（아래） == 5
	RETURN 0
;添い寝覗き
SIF TFLAG:405 == 2
	RETURN 0
;자위경험取得呼び出し
CALL NIGHT_SELF_UP_SELF

PRINTW 

;------------------------------------------------------
;主人睡眠中
@NIGHT_SELF_SLEEP
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 41
CALL KOJO_MESSAGE_EVENT
PRINTW 
;연모：勝손に添い寝、음란：勝손にご奉仕(と자위)、복종：발もとで寝る
IF TALENT:연모 || TALENT:친애
	CALL NIGHT_SELF_UP_SOINE
	TFLAG:405 = 2
ELSEIF TALENT:음란 || TALENT:창부
	EXP:펠라경험 += 2
	IF CFLAG:MASTER:11 >= 3 && PENIS(MASTER) && TALENT:MASTER:아이사이즈 == 0
		EXP:MASTER:사정경험 += 2
		;禁欲ポイント減らす
		CFLAG:MASTER:602 = 0
		EXP:정액경험 += 2
		PRINTFORML %CALLNAME:MASTER%に%EXPNAME:3%＋２
		PRINTFORML %EXPNAME:20%＋２
		CFLAG:MASTER:11 -= 2
	ENDIF
	;정조대でガード
	SIF TEQUIP:속옷（아래） == 5
		RETURN 0
	CALL NIGHT_SELF_UP_SELF
	TFLAG:405 = 1
ELSEIF TALENT:복종 || TALENT:예속
	S = 1
	IF CFLAG:2 >= 3000 || CFLAG:2 <= -3000
		S = 15
	ELSEIF CFLAG:2 >= 2000 || CFLAG:2 <= -2000
		S = 10
	ELSEIF CFLAG:2 >= 1000 || CFLAG:2 <= -1000
		S = 5
	ELSEIF CFLAG:2 >= 500 || CFLAG:2 <= -500
		S = 3
	ELSEIF CFLAG:2 >= 300 || CFLAG:2 <= -300
		S = 2
	ENDIF
	;순종、굴복
	PRINTFORML %PALAMNAME:5%の珠＋{S*100}
	PRINTFORML %PALAMNAME:7%の珠＋{S*100}
	JUEL:순종 += S*100
	JUEL:굴복 += S*100
ENDIF

PRINTW 

;------------------------------------------------------
;NTRプレイ 연모・畏怖対象のところへ行こうとしたのを引き止める
@NIGHT_SELF_NTR
;行うプレイの種類、K:5に記録
IF ((M == 0 && S) && ((TALENT:MASTER:수 || TALENT:MASTER:오메가 || TALENT:MASTER:공 == 0) || (TALENT:공 || TALENT:수 == 0 || TALENT:오메가 == 0))) || ((V == 0 && P) && ((TALENT:MASTER:공 || TALENT:MASTER:수 == 0 || TALENT:MASTER:오메가 == 0) || (TALENT:수 || TALENT:오메가 || TALENT:공 == 0)))
	;奴隷が공又は主人が수か오메가
	IF TALENT:공 || TALENT:MASTER:수 || TALENT:MASTER:오메가
		;かつ主人が공又は奴隷が수か오메가
		;主人バージン判定、奴隷の精力判定
		IF M == 0 && S
			;夜這い主人수
			K:5 = 9
		ENDIF
	ELSEIF TALENT:수 || TALENT:오메가 || TALENT:MASTER:공
		IF V == 0 && P
			;夜這い
			K:5 = 8
		ENDIF
	ELSE
		L:1 = RAND:5
		IF L:1 == 0 && M == 0 && S
			;夜這い主人수
			K:5 = 9
		ELSEIF V == 0 && P
			;夜這い
			K:5 = 8
		ENDIF
	ENDIF
ELSE
	;レズプレイ
	K:5 = 5
ENDIF

;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 42
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
SIF TEQUIP:속옷（아래） == 5
	RETURN 0

TFLAG:405 = 7

IF K:5 == 5
	CALL NIGHT_SELF_UP_RES
ELSEIF K:5 == 8
	CALL NIGHT_SELF_UP_SEME
ELSEIF K:5 == 9
	CALL NIGHT_SELF_UP_UKE
ENDIF

PRINTW 

;------------------------------------------------------
;자위
@SELF_CHECK5
;イベント입上呼び出し  
DRAWLINE
TFLAG:13 = 44
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
SIF TEQUIP:속옷（아래） == 5
	RETURN 0

TFLAG:405 = 10
CALL NIGHT_SELF_UP_SELF
PRINTW 

;------------------------------------------------------
;夜這い主人공
@SELF_CHECK6
;イベント입上呼び出し
DRAWLINE
TFLAG:13 = 9
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
SIF TEQUIP:속옷（아래） == 5
	RETURN 0

TFLAG:405 = 11
CALL NIGHT_SELF_UP_SEME
PRINTW 

;------------------------------------------------------
;夜這い主人수
@SELF_CHECK8
;イベント입上呼び出し
DRAWLINE
TFLAG:13 = 27
CALL KOJO_MESSAGE_EVENT
PRINTW 
;정조대でガード
SIF TEQUIP:속옷（아래） == 5
	RETURN 0

TFLAG:405 = 12
CALL NIGHT_SELF_UP_UKE
PRINTW 

;-------------------------------------------------------
;자위경험取得
@NIGHT_SELF_UP_SELF
;자위중독による자위チェック
A = 1
;자위중독を見る
IF ABL:자위중독 == 1
	A += 1
ELSEIF ABL:자위중독 == 2
	A += 2
ELSEIF ABL:자위중독 == 3
	A += 3
ELSEIF ABL:자위중독 == 4
	A += 5
ELSEIF ABL:자위중독 >= 5
	A += 7
ENDIF

;욕망とC감각によるボーナス
IF ABL:욕망 >= 5 && ABL:C감각 >= 5
	A += 3
ELSEIF ABL:욕망 >= 4 && ABL:C감각 >= 4
	A += 2
ELSEIF ABL:욕망 >= 3 && ABL:C감각 >= 3
	A += 1
ENDIF

;욕망と발정기によるボーナス
SIF ABL:욕망 >= 3 && TALENT:발정기
	A += 2

;자위하기쉬움
SIF TALENT:자위하기쉬움
	A += 2
;자위광
SIF TALENT:자위광
	A += 3

;자위、자위判定。ポイントが同じ場合は자위優先(C감각が０の場合は자위のみ)
;A감각見る
IF ABL:A감각 == 0
	B = 0
ELSEIF ABL:A감각 == 1
	B = 1
ELSEIF ABL:A감각 == 2
	B = 2
ELSEIF ABL:A감각 == 3
	B = 3
ELSEIF ABL:A감각 == 4
	B = 4
ELSEIF ABL:A감각 >= 5
	B = 5
ENDIF
;C감각見る
IF ABL:C감각 == 0
	C = 0
ELSEIF ABL:C감각 == 1
	C = 1
ELSEIF ABL:C감각 == 2
	C = 2
ELSEIF ABL:C감각 == 3
	C = 3
ELSEIF ABL:C감각 == 4
	C = 4
ELSEIF ABL:C감각 >= 5
	C = 5
ENDIF

;調教時にＡ快楽、Ｃ快楽をより稼いだほうに+1
IF PALAM:쾌A > PALAM:쾌C
	B += 1
ELSEIF PALAM:쾌C > PALAM:쾌A
	C += 1
ENDIF

;항문광だと자위しやすい+
IF TALENT:항문광
	B += 1
ENDIF

;공だと자위しないよ
SIF TALENT:공
	B = 0

;정조대があるときはＡのみ
SIF TEQUIP:속옷（아래） == 5
	C = 0

IF A > 0 && (C >= B)
	PRINTFORM %CALLNAME%は
	PRINTV A
	PRINTL 回자위をしたようだ。
	TFLAG:13 = 1
	PRINTFORML %EXPNAME:10%＋{A}
	PRINTFORML %PALAMNAME:0%の珠＋{A*500}
	PRINTFORML %PALAMNAME:5%の珠＋{A*100}
	PRINTFORML %PALAMNAME:6%の珠＋{A*250}
	EXP:자위경험 += A
	JUEL:쾌C += A*500
	JUEL:순종 += A*100
	JUEL:욕정 += A*250
ELSEIF A > 0 && (B > C)
	PRINTFORM %CALLNAME%は
	PRINTV A
	PRINTL 回후ろで자위をしたようだ。
	TFLAG:13 = 1
	PRINTFORML %EXPNAME:10%＋{A}
	PRINTFORML %EXPNAME:1%＋{A}
	PRINTFORML %PALAMNAME:2%の珠＋{A*500}
	PRINTFORML %PALAMNAME:6%の珠＋{A*100}
	PRINTFORML %PALAMNAME:7%の珠＋{A*250}
	EXP:자위경험 += A
	EXP:A경험 += A
	JUEL:쾌A += A*500
	JUEL:욕정 += A*100
	JUEL:굴복 += A*250
ENDIF
IF ABL:순종+ABL:봉사정신+ABL:노출벽 >= 10 && TIME == 0
		PRINTFORML %PALAMNAME:9%の珠＋{A*200}
		JUEL:수치 += A*200
ENDIF

;-------------------------------------------------------
;主人공セックス経験取得
@NIGHT_SELF_UP_SEME
PRINTW 
S = 1
;남자の場合はAを上げる
IF TALENT:남자 || (ABL:V감각 < ABL:A감각)
	IF ABL:A감각 == 1
		S += 1
	ELSEIF ABL:A감각 == 2
		S += 2
	ELSEIF ABL:A감각 == 3
		S += 3
	ELSEIF ABL:A감각 == 4
		S += 4
	ELSEIF ABL:A감각 >= 5
		S += 5
	ENDIF

ELSE
;V感覚
	IF ABL:V감각 == 1
		S += 1
	ELSEIF ABL:V감각 == 2
		S += 2
	ELSEIF ABL:V감각 == 3
		S += 3
	ELSEIF ABL:V감각 == 4
		S += 4
	ELSEIF ABL:V감각 >= 5
		S += 5
	ENDIF
ENDIF

;음란구멍
SIF TALENT:음란구멍
	S += 3
;항문광
SIF TALENT:항문광
	S += 3
;섹스광
SIF TALENT:섹스광
	S += 4
;발정기
SIF TALENT:발정기
	S += 2

;主人の사정制限
SIF S > CFLAG:MASTER:11
	S = CFLAG:MASTER:11
SIF S < 1
	S = 1

EXP:성교경험 += S
EXP:MASTER:성교경험 += S
EXP:MASTER:삽입경험 += S
IF TALENT:남자 || (ABL:V감각 < ABL:A감각) && CFLAG:108 == 0
	EXP:장내사정경험 += S/2
ELSEIF CFLAG:108 == 0
	EXP:질내사정경험 += S/2
ENDIF
;아이사이즈で無い
SIF TALENT:MASTER:아이사이즈 == 0
	EXP:정액경험 += S/2
JUEL:순종 += S*400
JUEL:욕정 += S*400
CFLAG:MASTER:11 -= S

IF TALENT:남자 || (ABL:V감각 < ABL:A감각)
	PRINTFORML %EXPNAME:1%＋{S}
	EXP:A경험 += S
ELSE
	PRINTFORML %EXPNAME:0%＋{S}
	EXP:V경험 += S
ENDIF
PRINTFORML %CALLNAME%と%CALLNAME:MASTER%に%EXPNAME:4%＋{S}
IF CFLAG:108 == 0
	IF TALENT:남자 || (ABL:V감각 < ABL:A감각)
		PRINTFORML %EXPNAME:14%＋{S/2}
	ELSE
		PRINTFORML %EXPNAME:5%＋{S/2}
	ENDIF
ENDIF
;아이사이즈で無い
SIF TALENT:MASTER:아이사이즈 == 0
	PRINTFORML %EXPNAME:20%＋{S/2}
IF TALENT:남자
	PRINTFORML %PALAMNAME:2%の珠＋{S*400}
	JUEL:쾌A += S*400
ELSE
	PRINTFORML %PALAMNAME:1%の珠＋{S*400}
	JUEL:쾌V += S*400
ENDIF
PRINTFORML %PALAMNAME:5%の珠＋{S*400}
PRINTFORML %PALAMNAME:6%の珠＋{S*400}

;-------------------------------------------------------
;主人수セックス経験取得
@NIGHT_SELF_UP_UKE
PRINTW 
S = 1

;C감각
IF ABL:C감각 == 1
	S += 1
ELSEIF ABL:C감각 == 2
	S += 2
ELSEIF ABL:C감각 == 3
	S += 3
ELSEIF ABL:C감각 == 4
	S += 4
ELSEIF ABL:C감각 >= 5
	S += 5
ENDIF

;섹스광
SIF TALENT:섹스광
	S += 4

;奴隷の사정制限
SIF S > CFLAG:TARGET:11
	S = CFLAG:TARGET:11
SIF S < 1
	S = 1
;성교경험・사정경험
PRINTFORML %CALLNAME%と%CALLNAME:MASTER%に%EXPNAME:4%＋{S}
;主人が남자でなくＡ能力よりＶ能力が高く、奴隷が아이사이즈でないとき질내사정경험
IF TALENT:아이사이즈 == 0 && TALENT:MASTER:남자 == 0 && (ABL:V감각 >= ABL:A감각)
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:5%＋{S/2}
	EXP:MASTER:질내사정경험 += S/2
	;禁欲ポイント減らす
	CFLAG:602 = 0
;奴隷が아이사이즈でないとき장내사정경험
ELSEIF TALENT:아이사이즈 == 0
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:14%＋{S/2}
	EXP:MASTER:장내사정경험 += S/2
	;禁欲ポイント減らす
	CFLAG:602 = 0
ENDIF
;아이사이즈で無い
SIF TALENT:아이사이즈 == 0
	PRINTFORML %EXPNAME:3%＋{S/2}
PRINTFORML %PALAMNAME:0%の珠＋{S*400}
PRINTFORML %PALAMNAME:5%の珠＋{S*400}
PRINTFORML %PALAMNAME:6%の珠＋{S*400}
EXP:성교경험 += S
EXP:삽입경험 += S
;아이사이즈で無い
IF TALENT:아이사이즈 == 0
	EXP:사정경험 += S/2
	;禁欲ポイント減らす
	CFLAG:602 = 0
ENDIF
JUEL:쾌C += S*400
JUEL:순종 += S*400
JUEL:욕정 += S*400
CFLAG:TARGET:11 -= S
;主人に성교경험
EXP:MASTER:성교경험 += S

;-------------------------------------------------------
;添い寝経験取得
@NIGHT_SELF_UP_SOINE
S = 1
IF CFLAG:2 >= 3000 || CFLAG:2 <= -3000
	S = 15
ELSEIF CFLAG:2 >= 2000 || CFLAG:2 <= -2000
	S = 10
ELSEIF CFLAG:2 >= 1000 || CFLAG:2 <= -1000
	S = 5
ELSEIF CFLAG:2 >= 500 || CFLAG:2 <= -500
	S = 3
ELSEIF CFLAG:2 >= 300 || CFLAG:2 <= -300
	S = 2
ENDIF
;스킨십선호
SIF TALENT:스킨십선호
	S += 2
;스킨십불편
IF TALENT:스킨십불편
	IF S == 2
		S = 1
	ELSEIF S > 2
		S -= 2
	ENDIF
ENDIF
;소인체형、유치、幼児退行
SIF TALENT:소인체형 || TALENT:유아／유아퇴행 || TALENT:유치
	S += 1
;애정경험
EXP:애정경험 += S
;순종
JUEL:순종 += S*100
PRINTFORML %EXPNAME:23%＋{S}
PRINTFORML %PALAMNAME:5%の珠＋{S*100}

;실금버릇
IF TALENT:실금버릇 || TALENT:MASTER:실금버릇
	PRINTW 
	DRAWLINE
	PRINTFORML 次の朝、シーツには立派な世界地図が出来ていた……
	PRINTFORML %PALAMNAME:9%の珠＋500
	JUEL:수치 += 500
	IF TALENT:실금버릇
		EXP:배뇨경험 += 2
		PRINTFORML %CALLNAME%の%EXPNAME:31%＋2
	ENDIF
	IF TALENT:MASTER:실금버릇
		EXP:MASTER:배뇨경험 += 2
		PRINTFORML %CALLNAME:MASTER%の%EXPNAME:31%＋2
	ENDIF
ENDIF

;-------------------------------------------------------
;レズプレイ経験取得
@NIGHT_SELF_UP_RES
S = 1
;C감각、B감각
IF ABL:C감각 >= 5 || ABL:B감각 >= 5 
	S += 5
ELSEIF ABL:C감각 >= 4 || ABL:B감각 >= 4
	S += 4
ELSEIF ABL:C감각 >= 3 || ABL:B감각 >= 3
	S += 3
ELSEIF ABL:C감각 >= 2 || ABL:B감각 >= 2
	S += 2
ELSEIF ABL:C감각 >= 1 || ABL:B감각 >= 1
	S += 1
ENDIF

;음란가슴
SIF TALENT:음란가슴
	S += 2
;奴隷の사정制限
;SIF S > CFLAG:TARGET:11
;	S = CFLAG:TARGET:11
;절정경험
EXP:절정경험 += S
PRINTFORML %EXPNAME:2%＋{S}
;奴隷が사정できれば、奴隷に사정경험、主人に정액경험
IF PENIS(TARGET) && TALENT:아이사이즈 == 0
	EXP:사정경험 += S/2
	EXP:MASTER:정액경험 += S/2
	;禁欲ポイント減らす
	CFLAG:602 = 0
	CFLAG:MASTER:602 = 0
	PRINTFORML %EXPNAME:3%＋{S/2}
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:20%＋{S/2}
	CFLAG:TARGET:11 -= S/2
ENDIF
;主人が사정できれば、主人に사정경험、奴隷に정액경험
IF PENIS(MASTER) && TALENT:MASTER:아이사이즈 == 0
	EXP:MASTER:사정경험 += S/2
	;禁欲ポイント減らす
	CFLAG:MASTER:602 = 0
	EXP:정액경험 += S/2
	PRINTFORML %CALLNAME:MASTER%に%EXPNAME:3%＋{S/2}
	PRINTFORML %EXPNAME:20%＋{S/2}
	CFLAG:MASTER:11 -= S/2
ENDIF
;同性同士なら레즈경험・게이경험
IF MALE(TARGET) && MALE(MASTER)
	EXP:게이경험 += S
	EXP:MASTER:게이경험 += S
	PRINTFORML %CALLNAME:MASTER%と%CALLNAME%に%EXPNAME:41%＋{S}
ENDIF
IF  MALE(TARGET) == 0 && MALE(MASTER) == 0
	EXP:레즈경험 += S
	EXP:MASTER:레즈경험 += S
	PRINTFORML %CALLNAME:MASTER%と%CALLNAME%に%EXPNAME:40%＋{S}
ENDIF
;쾌C、쾌B、순종、욕정
PRINTFORML %PALAMNAME:0%の珠＋{S*200}
PRINTFORML %PALAMNAME:3%の珠＋{S*200}
PRINTFORML %PALAMNAME:5%の珠＋{S*200}
PRINTFORML %PALAMNAME:6%の珠＋{S*200}
JUEL:쾌C += S*200
JUEL:쾌B += S*200
JUEL:순종 += S*200
JUEL:욕정 += S*200

