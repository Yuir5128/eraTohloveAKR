;≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡
;입上呼び出し用ターミナルファイル
;≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡≡
;--------------------------------------------------
;調教開始입上の呼び出し
;--------------------------------------------------
@EVENTSHOP
#PRI
SIF FLAG:7 == 0
	FLAG:7 = 2

@EVENTTRAIN
DRAWLINE
SIF FLAG:7 <= 0 || TALENT:기절
	RETURN 0
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 3)
IF RESULT == 1
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	;エクストラモード構文
	$SELECT1
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXTRAMODE_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULTS = 
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECT1
		ENDIF
	ENDIF
	RESULT = 0
	;調教開始時
	TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 3)
	$SELECT2
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EVENTTRAIN_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULTS = 
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECT2
		ENDIF
	ENDIF
	IF RESULT == 1
		RESETCOLOR
		RETURN RESULT
	ENDIF
	RESULT = 0
	;簡易助손입上
	TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 3)
	$SELECT3
	IF ASSI > -1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EVENTTRAIN_ASSIPLAY_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF STRLENS(RESULTS) && !RESULT
		RESULTS = 
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECT3
		ENDIF
	ENDIF
	;旧テンプレの関数を探してみるテスト
	SIF !RESULT
		TRYCALLFORM KOJO_EVENTTRAIN_K{NO:TARGET}
	RESETCOLOR
ELSEIF RESULT == 2
;	TRYCALLFORM KOJO%RESULTS:1%_EVENTTRAIN_K{NO:TARGET}
	TRYCCALLFORM KOJO%RESULTS:1%_EVENTTRAIN_K{NO:TARGET}
	CATCH
		TRYCALLFORM KOJO_EVENTTRAIN_K{NO:TARGET}
	ENDCATCH
ENDIF

;==================================================
;調教終了時입上部
;==================================================
@EVENTEND
DRAWLINE
SIF FLAG:7 <= 0 || TALENT:기절
	RETURN 0
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 4)
IF RESULT == 1
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	;調教終了時
	$SELECT1
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EVENTEND_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECT1
		ENDIF
	ENDIF
	IF RESULT == 1
		RESETCOLOR
		RETURN RESULT
	ENDIF
	RESULT = 0
	;簡易助손입上
	TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 4)
	$SELECT2
	IF ASSI > -1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_ASSIEND_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECT2
		ENDIF
	ENDIF
	;旧テンプレの関数を探してみるテスト
	SIF !RESULT
		TRYCALLFORM KOJO_EVENTEND_K{NO:TARGET}
	RESETCOLOR
ELSEIF RESULT == 2
	TRYCCALLFORM KOJO%RESULTS:1%_EVENTEND_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
DRAWLINE

;--------------------------------------------------
;@KOJO_MESSAGE_COM関係
;コマンド実行時に出力されます
;--------------------------------------------------
@KOJO_MESSAGE_COM
;テキストを表示しない
SIF !FLAG:6
	RETURN 0
;道具着脱分岐を呼ぶ
CALL MESSAGE_VARIATION
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 1)
LOCAL = RESULT
IF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	CALL EQUIPTEXT
	CALL TRAIN_MESSAGE
	IF LOCAL == 3
		TRYCALLFORM KOJO_MESSAGE_COM_{NO:TARGET}
	ELSEIF !FLAG:152
		CALL PANT_VOICE_EX
	ENDIF
	RETURN 0
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_TRAIN_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	TRYCALLFORM KOJO_TRAIN_MESSAGE_SKIP_K{NO:TARGET}
ENDCATCH
LOCAL:2 = RESULT
;PANCTION内の装備品입上補完関数を使用する
IF !TFLAG:59
	CALL EQUIPTEXT
ENDIF
IF LOCAL:2
	CALL TRAIN_MESSAGE
	RETURN 0
ENDIF
IF LOCAL == 1
	;条件に当てはまる場合、対象限定の입上呼び出し（コマンド別＞汎用コマンド＞汎用喘ぎ）→
	;→見つからなかったら排他処理を確認→排他チェックされてなかったら対象非限定입上呼び出し（コマンド別＞汎用コマンド＞汎用喘ぎ）
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_COM_K{NO:TARGET}_{SELECTCOM}
	CATCH
		RESULT = 0
	ENDCATCH
	IF !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_COMMON_EXCOM_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		SIF !RESULT
			CALL COMMON_KOJO_EX
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCOM_K{NO:TARGET}_{RESULT}
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ELSE
			RESULT = 0
		ENDIF
	ENDIF
;	SIF !RESULT
;		CALL TRAIN_MESSAGE_COLOR
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		;何も見つからなかったら地の文と汎用喘ぎを呼び出し
		TRYCCALLFORM KOJO_MESSAGE_COM_K{NO:TARGET}
		CATCH
			CALL TRAIN_MESSAGE_COLOR
			SIF !FLAG:152
				CALL PANT_VOICE_EX
		ENDCATCH
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_COM_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;カラー変更してコマンド입上地の文を呼び出し
@TRAIN_MESSAGE_COLOR
RESETCOLOR
CALL TRAIN_MESSAGE
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_DENIAL関係
;コマンド実行判定をトリガーにした입上と実行判定操作
;実行不可になる直前に表示される
;-------------------------------------------------
;コマンド実行判定操作
@KOJO_DENIAL_PLUS
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 1)
SIF !RESULT
	RETURN 0
$SELECTER
RESULT = 0
TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_DENIAL_PLUS_K{NO:TARGET}
CATCH
	TRYCCALLFORM KOJO%RESULTS:1%_DENIAL_PLUS_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDCATCH
IF STRLENS(RESULTS) && !RESULT
	RESULTS = 
	GOTO SELECTER
ENDIF
RETURN RESULT

;コマンド実行判定をトリガーにした입上
@KOJO_DENIAL
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
PRINTL 
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 1)
LOCAL = RESULT
IF !RESULT || FLAG:7 <= 0 || RESULT == 2 || TALENT:기절
	CALL DENIAL_MESSAGE
	RETURN 0
ENDIF
RESULT = 0
$SELECTER
SIF !FLAG:97 && LOCAL
	TRYCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
RESULT = 0
TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_DENIAL_K{NO:TARGET}_{SELECTCOM}
CATCH
	RESULT = 0
ENDCATCH
IF !RESULT
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXDENIAL_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
IF STRLENS(RESULTS) && !RESULT
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
	IF !RESULT
		RESULTS = 
		GOTO SELECTER
	ENDIF
ENDIF
SIF !RESULT
	CALL DENIAL_MESSAGE_COLOR
RESETCOLOR
RETURN RESULT

;カラー変更して地の文を呼び出し
@DENIAL_MESSAGE_COLOR
RESETCOLOR
CALL DENIAL_MESSAGE
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_PALAMCNG関係
;パラメータ変動をトリガーにした입上
;パラメータ変動후に입上を発動します
;-------------------------------------------------
;調教者の사정テキスト
@KOJO_MESSAGE_PALAMCNG_A
;テキストを表示しない
SIF !FLAG:6
	RETURN 0
RESULT = 0
RESULTS = 
RESULTS:1 = 
LOCAL:2 = 0
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET,2)
LOCAL = RESULT
SIF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	GOTO PALAM_MESSAGE_A
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
SIF RESULT
	GOTO PALAM_MESSAGE_A
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	;調教者空사정
	IF TFLAG:164
		LOCAL:2 = 21
	;사정先選択
	ELSEIF CFLAG:106
		LOCAL:2 = CFLAG:106
	;キス、스마타、풋잡、애널強制奉仕、더블스마타で사정
	ELSEIF TFLAG:9
		LOCAL:2 = 11
	;조수를범한다、촉수에범하게시킨다で사정
	ELSEIF TFLAG:7
		LOCAL:2 = 12
	;입で사정
	ELSEIF TFLAG:0
		LOCAL:2 = 13
	;손で사정
	ELSEIF TFLAG:1
		LOCAL:2 = 14
	;가슴で사정
	ELSEIF TFLAG:34
		LOCAL:2 = 15
	;발で사정
	ELSEIF TFLAG:16
		LOCAL:2 = 16
	ELSEIF TFLAG:2
		;애널セックスで사정
		IF SEXPLAY(TARGET) == 2
			LOCAL:2 = 17
		;セックスで사정
		ELSE
			LOCAL:2 = 18
		ENDIF
	ELSEIF SEXPLAY(TARGET) > 2 && TFLAG:12
		;逆セックスで調教対象が同時に사정
		IF TFLAG:10 > 0
			LOCAL:2 = 19
		;逆セックスで사정
		ELSE
			LOCAL:2 = 20
		ENDIF
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_A_K{NO:TARGET}_{LOCAL:2}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
;	SIF !RESULT
;		CALL PALAM_MESSAGE_A_COLOR
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_A_K{NO:TARGET}
		CATCH
			CALL PALAM_MESSAGE_A_COLOR
		ENDCATCH
	ENDIF
	RESETCOLOR
	;調教者以外の사정
	IF TFLAG:43
		RESULT = 0
		$SELECTER2
		IF !FLAG:97
			TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
			CATCH
				CALLFORM KOJO_COLOR_K{NO:TARGET}
			ENDCATCH
		ENDIF
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_A_K{NO:TARGET}_22
		CATCH
			RESULT = 0
		ENDCATCH
		IF STRLENS(RESULTS) && !RESULT
			RESULT = 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
			CATCH
				RESULT = 0
			ENDCATCH

			IF !RESULT
				RESULTS = 
				GOTO SELECTER2
			ENDIF
		ENDIF
;		SIF !RESULT
;			CALL PALAM_MESSAGE_A_SUB_COLOR
		IF !RESULT
			;旧テンプレの関数を探してみるテスト
			TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_A_K{NO:TARGET}
			CATCH
				CALL PALAM_MESSAGE_A_SUB_COLOR
			ENDCATCH
		ENDIF
		RESETCOLOR
	ENDIF
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_A_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;地の文を呼び出し
$PALAM_MESSAGE_A
RESETCOLOR
CALL PALAM_MESSAGE_A
SIF TFLAG:43
	CALL PALAM_MESSAGE_A_SUB
RETURN 0

;カラー変更して地の文を呼び出し
@PALAM_MESSAGE_A_COLOR
RESETCOLOR
CALL PALAM_MESSAGE_A
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

@PALAM_MESSAGE_A_SUB_COLOR
RESETCOLOR
CALL PALAM_MESSAGE_A_SUB
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_PALAMCNG関係
;パラメータ変動をトリガーにした입上
;パラメータ変動후に입上を発動します
;-------------------------------------------------
;奴隷の絶頂をトリガーにしたテキスト
@KOJO_MESSAGE_PALAMCNG_B
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 2)
LOCAL = RESULT
IF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	CALL PALAM_MESSAGE_B(1)
	RETURN 0
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
IF RESULT
	CALL PALAM_MESSAGE_B(1)
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	;絶頂
	IF TFLAG:29 > 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_1
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
	SIF !RESULT
		CALL PALAM_MESSAGE_B_COLOR
	;絶頂と同時に사정/空사정/사정관리解除で사정
	IF TFLAG:10 > 0 || NOWEX:40
		RESULT = 0
		TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET)
		$SELECTER1
		;사정관리解除で사정
		IF SELECTCOM == 134 && TEQUIP:사정관리 == 0 && TFLAG:10 > 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_2
			CATCH
				RESULT = 0
			ENDCATCH
		;空사정
		ELSEIF NOWEX:40
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_3
			CATCH
				RESULT = 0
			ENDCATCH
		;사정
		ELSE
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_4
			CATCH
				RESULT = 0
			ENDCATCH
		ENDIF
		IF STRLENS(RESULTS) && !RESULT
			RESULT = 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
			CATCH
				RESULT = 0
			ENDCATCH

			IF !RESULT
				RESULTS = 
				GOTO SELECTER1
			ENDIF
		ENDIF
	ENDIF
	;絶頂と同時に噴乳
	IF TFLAG:11 > 0
		RESULT = 0
		TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET)
		$SELECTER2
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_5
		CATCH
			RESULT = 0
		ENDCATCH
		IF STRLENS(RESULTS) && !RESULT
			RESULT = 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
			CATCH
				RESULT = 0
			ENDCATCH

			IF !RESULT
				RESULTS = 
				GOTO SELECTER2
			ENDIF
		ENDIF
	ENDIF
	;絶頂と同時に放尿
	IF TFLAG:68 > 0
		RESULT = 0
		TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET)
		$SELECTER3
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_6
		CATCH
			RESULT = 0
		ENDCATCH
		IF STRLENS(RESULTS) && !RESULT
			RESULT = 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
			CATCH
				RESULT = 0
			ENDCATCH

			IF !RESULT
				RESULTS = 
				GOTO SELECTER3
			ENDIF
		ENDIF
	ENDIF
	;絶頂と同時に脱糞
	IF TFLAG:58 > 0
		RESULT = 0
		TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET)
		$SELECTER4
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_7
		CATCH
			RESULT = 0
		ENDCATCH
		IF STRLENS(RESULTS) && !RESULT
			RESULT = 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
			CATCH
				RESULT = 0
			ENDCATCH

			IF !RESULT
				RESULTS = 
				GOTO SELECTER4
			ENDIF
		ENDIF
	ENDIF
	;絶頂と同時に嘔吐
	IF TFLAG:75 > 0
		RESULT = 0
		TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET)
		$SELECTER5
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_B_K{NO:TARGET}_8
		CATCH
			RESULT = 0
		ENDCATCH
		IF STRLENS(RESULTS) && !RESULT
			RESULT = 0
			TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
			CATCH
				RESULT = 0
			ENDCATCH

			IF !RESULT
				RESULTS = 
				GOTO SELECTER5
			ENDIF
		ENDIF
	ENDIF
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		;ここの処理に関しては全く自信がない
		IF TEQUIP:볼개그 && SELECTCOM != 132
		ELSE
			TRYCALLFORM KOJO_MESSAGE_PALAMCNG_B_K{NO:TARGET}
		ENDIF
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_B_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;カラー変更して地の文を呼び出し
@PALAM_MESSAGE_B_COLOR
RESETCOLOR
CALL PALAM_MESSAGE_B(1)
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_PALAMCNG関係
;パラメータ変動をトリガーにした입上
;パラメータ変動후に입上を発動します
;-------------------------------------------------
;調教후の変化をトリガーにした입上
@KOJO_MESSAGE_PALAMCNG_C
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 2)
LOCAL = RESULT
IF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	CALL PALAM_MESSAGE_C
	RETURN 0
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
IF RESULT
	CALL PALAM_MESSAGE_C
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	;처녀喪失(처녀のみ)
	IF TFLAG:3 > 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_C_K{NO:TARGET}_1
		CATCH
			RESULT = 0
		ENDCATCH
	;동정喪失
	ELSEIF TFLAG:160 == 1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_C_K{NO:TARGET}_2
		CATCH
			RESULT = 0
		ENDCATCH
	;백버진喪失
	ELSEIF TFLAG:161 == 1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_C_K{NO:TARGET}_3
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
;	SIF !RESULT
;		CALL PALAM_MESSAGE_C_COLOR
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		;何も見つからなかったら地の文を呼び出し
		TRYCCALLFORM KOJO_MESSAGE_PALAMCNG_C_K{NO:TARGET}
		CATCH
			CALL PALAM_MESSAGE_C_COLOR
		ENDCATCH
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_C_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;カラー変更して地の文を呼び出し
@PALAM_MESSAGE_C_COLOR
RESETCOLOR
CALL PALAM_MESSAGE_C
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_PALAMCNG関係
;パラメータ変動をトリガーにした입上
;パラメータ変動후に입上を発動します
;-------------------------------------------------
;パラメータ変化をトリガーにした입上
@KOJO_MESSAGE_PALAMCNG_D
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 2)
LOCAL = RESULT
IF RESULT == 3
	CALL PALAM_MESSAGE_D
	TRYCALLFORM KOJO_MESSAGE_PALAMCNG_{NO:TARGET}
	RETURN 0
ELSEIF !RESULT || FLAG:7 <= 0 || TALENT:기절
	CALL PALAM_MESSAGE_D
	RETURN 0
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
IF RESULT
	CALL PALAM_MESSAGE_D
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_D_K{NO:TARGET}_1
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
;	SIF !RESULT
;		CALL PALAM_MESSAGE_D_COLOR
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		;何も見つからなかったら地の文を呼び出し
		TRYCCALLFORM KOJO_MESSAGE_PALAMCNG_D_K{NO:TARGET}
		CATCH
			CALL PALAM_MESSAGE_D_COLOR
		ENDCATCH
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_D_K{NO:TARGET}
	CATCH
		TRYCALLFORM KOJO_MESSAGE_PALAMCNG_D_K{NO:TARGET}
	ENDCATCH
ENDIF
RETURN RESULT

;カラー変更して地の文を呼び出し
@PALAM_MESSAGE_D_COLOR
RESETCOLOR
CALL PALAM_MESSAGE_D
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_PALAMCNG関係
;パラメータ変動をトリガーにした입上
;パラメータ変動후に입上を発動します
;-------------------------------------------------
;촉수が사정
@KOJO_MESSAGE_PALAMCNG_E
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
;촉수が사정していなければ戻る
SIF TFLAG:15 <= 0
	RETURN 0
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 2)
LOCAL = RESULT
IF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	CALL PALAM_MESSAGE_E
	RETURN 0
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
IF RESULT
	CALL PALAM_MESSAGE_E
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_PALAMCNG_E_K{NO:TARGET}_1
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
;	SIF !RESULT
;		CALL PALAM_MESSAGE_E_COLOR
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		;何も見つからなかったら地の文を呼び出し
		TRYCCALLFORM KOJO_MESSAGE_PALAMCNG_E_K{NO:TARGET}
		CATCH
			CALL PALAM_MESSAGE_E_COLOR
		ENDCATCH
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_PALAMCNG_E_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;カラー変更して地の文を呼び出し
@PALAM_MESSAGE_E_COLOR
RESETCOLOR
CALL PALAM_MESSAGE_E
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_MARKCNG関係
;刻印変動をトリガーにした입上
;刻印変動후に입上を発動します
;-------------------------------------------------
@KOJO_MESSAGE_MARKCNG
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 2)
LOCAL = RESULT
IF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	CALL MARK_MESSAGE
	SIF LOCAL == 3
		TRYCALLFORM KOJO_MESSAGE_MARKCNG_{NO:TARGET}
	RETURN 0
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	TRYCALLFORM KOJO_PALAM_MESSAGE_SKIP_K{NO:TARGET}
ENDCATCH
IF RESULT
	CALL MARK_MESSAGE
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	;고통각인
	IF TFLAG:22
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_MARKCNG_K{NO:TARGET}_1_{TFLAG:22}
		CATCH
			RESULT = 0
		ENDCATCH
		IF RESULT
			LOCAL = 0
		ELSE
			CALL MARK_MESSAGE_COLOR("A")
		ENDIF
	ENDIF
	;쾌락각인
	IF TFLAG:23
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_MARKCNG_K{NO:TARGET}_2_{TFLAG:23}
		CATCH
			RESULT = 0
		ENDCATCH
		IF RESULT
			LOCAL = 0
		ELSE
			CALL MARK_MESSAGE_COLOR("P")
		ENDIF
	ENDIF
	;굴복각인
	IF TFLAG:24
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_MARKCNG_K{NO:TARGET}_3_{TFLAG:24}
		CATCH
			RESULT = 0
		ENDCATCH
		IF RESULT
			LOCAL = 0
		ELSE
			CALL MARK_MESSAGE_COLOR("S")
		ENDIF
	ENDIF
	;반발각인
	IF TFLAG:21
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_MARKCNG_K{NO:TARGET}_4_{TFLAG:21}
		CATCH
		ENDCATCH
		IF RESULT
			LOCAL = 0
		ELSE
			CALL MARK_MESSAGE_COLOR("R")
		ENDIF
	ENDIF
	IF STRLENS(RESULTS) && !LOCAL
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
	IF !RESULT && LOCAL
		;旧テンプレの関数を探してみるテスト
		TRYCCALLFORM KOJO_MESSAGE_MARKCNG_K{NO:TARGET}
			RESULT = 1
			LOCAL = 0
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF !RESULT && LOCAL
		;何も見つからなかったら地の文を呼び出し
		CALL MARK_MESSAGE_COLOR
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_MARKCNG_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;カラー変更して地の文を呼び出し
@MARK_MESSAGE_COLOR(ARGS)
RESETCOLOR
IF STRLENS(ARGS)
	CALLFORM MARK_MESSAGE_%ARGS%
ELSEIF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ELSE
	CALL MARK_MESSAGE
ENDIF

;-------------------------------------------------
;@KOJO_MESSAGE_MARKCNG関係
;コマンド実行후に表示される입上
;-------------------------------------------------
@KOJO_MESSAGE_COMEND
;テキストを表示しない
SIF !FLAG:6
	RETURN 0
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 2)
LOCAL = RESULT
SIF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	RETURN 0
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_PALAM_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
SIF RESULT
	RETURN 0
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCOMEND_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_EXCOMEND_K{NO:TARGET}
	CATCH
		TRYCALLFORM KOJO_EXCOMEND_K_K{NO:TARGET}
	ENDCATCH
ENDIF
RETURN RESULT


;-------------------------------------------------
;@KOJO_MESSAGE_EVENT関係
;イベント時の입上、イベント開始時に出力します
;-------------------------------------------------
@KOJO_MESSAGE_EVENT
;テキストを表示しない
IF !FLAG:6
	RETURN 0
ENDIF
;TARGETいなかったらかえるよ！
IF TARGET < 0
	CALL EVENT_MESSAGE
	RETURN 0
ENDIF
LOCAL:1 = 0
;연모・복종の状態が現在の主人とあっていないとき、状態を保存して対応（TARGETのみ）
IF (KANRAKU2(TARGET) == 1 || KANRAKU2(TARGET) == 3) && TALENT:(CFLAG:39) != (CFLAG:41 == NO:MASTER)
	LOCAL:1 = 1
	;LOCAL:2にあるべき연모・복종の値を代入して現在の値と入れ替え
	LOCAL:2 = (CFLAG:41 == NO:MASTER)
	SWAP TALENT:(CFLAG:39), LOCAL:2
	;상사상애のときの処理
	SIF CFLAG:39 == 165
		TALENT:친애 = TALENT:상사상애
ENDIF
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 5)
LOCAL = RESULT
IF !RESULT || RESULT == 3 || FLAG:7 <= 0 || TALENT:기절
	CALL EVENT_MESSAGE
	SIF LOCAL == 3
		TRYCALLFORM SELF_KOJO_K{NO:TARGET}
	RESULT = 0
	GOTO END
ENDIF
RESULT = 0
;입上スキップ
TRYCCALLFORM KOJO%RESULTS:1%_EVENT_MESSAGE_SKIP_K{NO:TARGET}
CATCH
	RESULT = 0
ENDCATCH
IF RESULT
	CALL EVENT_MESSAGE
	RESULT = 0
	GOTO END
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_EVENT_K{NO:TARGET}_{TFLAG:13}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
;	SIF !RESULT
;		CALL EVENT_MESSAGE_COLOR
	IF !RESULT
		;旧テンプレの関数を探してみるテスト
		;何も見つからなかったら地の文を呼び出し
		TRYCCALLFORM KOJO_MESSAGE_EVENT_K{NO:TARGET}
		CATCH
			CALL EVENT_MESSAGE_COLOR
		ENDCATCH
	ENDIF
	RESETCOLOR
ELSE
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_EVENT_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
$END
;연모・복종を元の状態に戻す
IF LOCAL:1
	TALENT:(CFLAG:39) = LOCAL:2
	;상사상애のときの処理
	SIF CFLAG:39 == 165
		TALENT:친애 = LOCAL:2
ENDIF
RETURN RESULT

;カラー変更して地の文を呼び出し
@EVENT_MESSAGE_COLOR
RESETCOLOR
CALL EVENT_MESSAGE
IF !FLAG:97
	TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
	CATCH
		CALLFORM KOJO_COLOR_K{NO:TARGET}
	ENDCATCH
ENDIF

;-------------------------------------------------
;@DAILY_LIFE_MASSAGE関係
;休憩実行時に出力します
;選択されるのは必ずしもTARGETとは限りません（입上主はAに入っています）
;-------------------------------------------------
@DAILY_LIFE_MASSAGE
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:A}(A, 5)
IF !RESULT || FLAG:7 <= 0
	RETURN 0
ELSEIF RESULT == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:A}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:A}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_DAILY_LIFE_MASSAGE_K{NO:A}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:A}
		CATCH
			RESULT = 0
		ENDCATCH
		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
	RESETCOLOR
ELSE
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%_DAILY_LIFE_MASSAGE_K{NO:A}
	CATCH
		RESULT = 0
	ENDCATCH
ENDIF
RETURN RESULT

;-------------------------------------------------
;@KOJO_MESSAGE_ENDING関係
;イベント時の입上、イベント開始時に出力します
;-------------------------------------------------
@KOJO_MESSAGE_ENDING
;연모・복종を現在の主人にあわせる
CALL MASTER_CHANGE_ON
CALL MASTER_CHANGE_OFF
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 6)
LOCAL = RESULT
SIF !RESULT
	RETURN 0
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	;친애単体エンド
	IF TALENT:친애 && CFLAG:21 == 1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_ENDING_K{NO:TARGET}_1
		CATCH
			RESULT = 0
		ENDCATCH
	;창부単体エンド
	ELSEIF TALENT:창부 && CFLAG:21 == 1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_ENDING_K{NO:TARGET}_2
		CATCH
			RESULT = 0
		ENDCATCH
	;예속単体エンド
	ELSEIF TALENT:예속 && CFLAG:21 == 1
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_ENDING_K{NO:TARGET}_3
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	;特殊ハーレムエンド
	IF CFLAG:21 == 2
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_MESSAGE_ENDING_K{NO:TARGET}_4
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
	;旧テンプレの関数を探してみるテスト
	IF !RESULT
		TRYCCALLFORM KOJO_MESSAGE_ENDING_K{NO:TARGET}
			RESULT = 1
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	RESETCOLOR
	SIF !RESULT
		RETURN 0
	CALL GAME_CONTINUE
ELSEIF LOCAL == 2
	TRYCCALLFORM KOJO%RESULTS:1%_MESSAGE_ENDING_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
ELSE
	TRYCALLFORM SINGLE_ENDING_K{NO:TARGET}
ENDIF
RETURN RESULT

;-------------------------------------------------
;キャラ別の売却후エピソード
;-------------------------------------------------
@SET_SLAVE_AFTERWARDS
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{NO:TARGET}(TARGET, 7)
LOCAL = RESULT
IF !RESULT
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%_COLOR_K{NO:TARGET}
		CATCH
			CALLFORM KOJO_COLOR_K{NO:TARGET}
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_SET_SLAVE_AFTERWARDS_K{NO:TARGET}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULT = 0
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_EXCLUSION_K{NO:TARGET}
		CATCH
			RESULT = 0
		ENDCATCH

		IF !RESULT
			RESULTS = 
			GOTO SELECTER
		ENDIF
	ENDIF
	;旧テンプレの関数を探してみるテスト
	SIF !RESULT
		TRYCALLFORM SET_SLAVE_AFTERWARDS_K{NO:TARGET}
	RESETCOLOR
ELSE
	TRYCALLFORM SET_SLAVE_AFTERWARDS_K{NO:TARGET}
ENDIF
RETURN RESULT

;売却후に使うのでNO:TARGETは使えない
@SHOW_SLAVE_AFTERWARDS
RESULT = 0
RESULTS = 
RESULTS:1 = 
TRYCALLFORM SELECTER_K{X}(X, 7)
LOCAL = RESULT
IF !RESULT
	RETURN 0
ENDIF
IF LOCAL == 1
	$SELECTER
	IF !FLAG:97
		TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_COLOR_K{X}
		CATCH
			RESULT = 0
		ENDCATCH
	ENDIF
	RESULT = 0
	TRYCCALLFORM KOJO%RESULTS:1%%RESULTS%_SHOW_SLAVE_AFTERWARDS_K{X}
	CATCH
		RESULT = 0
	ENDCATCH
	IF STRLENS(RESULTS) && !RESULT
		RESULTS = 
		GOTO SELECTER
	ENDIF
	;旧テンプレの関数を探してみるテスト
	SIF !RESULT
		TRYCALLFORM SHOW_SLAVE_AFTERWARDS_K{X}
	RESETCOLOR
ELSE
	TRYCALLFORM SHOW_SLAVE_AFTERWARDS_K{X}
ENDIF
RETURN RESULT

;-------------------------------------------------
;主人公によって分岐するオープニング입上1
;共通のオープニングの前に呼び出される
;-------------------------------------------------
@KOJO_PRE_OPENING_STORY
TRYCALLFORM KOJO_PRE_OPENING_STORY_K{NO:MASTER}
RETURN RESULT

;-------------------------------------------------
;主人公によって分岐するオープニング입上2
;共通のオープニングの후に呼び出される
;-------------------------------------------------
@KOJO_POST_OPENING_STORY
TRYCALLFORM KOJO_POST_OPENING_STORY_K{NO:MASTER}

;-------------------------------------------------
;主人公によって分岐するバッドエンド１입上
;日数超過バッドエンド時に呼びだされる
;-------------------------------------------------
@KOJO_BAD1_ENDING_STORY
TRYCALLFORM KOJO_BAD1_ENDING_STORY_K{NO:MASTER}
RETURN RESULT

;-------------------------------------------------
;主人公によって分岐するバッドエンド２입上
;所持金が底をついたエンドの후に表示される
;-------------------------------------------------
@KOJO_BAD2_ENDING_STORY
TRYCALLFORM KOJO_BAD2_ENDING_STORY_K{NO:MASTER}
RETURN RESULT

;-------------------------------------------------
;主人公によって分岐するノーマルエンド입上
;ノーマルエンド時に呼び出される
;-------------------------------------------------
@KOJO_NORMAL_ENDING_STORY
TRYCALLFORM KOJO_NORMAL_ENDING_STORY_K{NO:MASTER}
RETURN RESULT


