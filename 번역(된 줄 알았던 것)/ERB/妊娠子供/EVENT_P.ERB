;EVENT_P, EVENT_PREGNANCY, 임신관련의 이벤트

;---------------------------------------------------------
;플래그 관리 입상용의 플래그와 입으므로, 변경
;---------------------------------------------------------

;CFLAG
;101→누구에게 의해 어디서임신 당했는지
;(1의 위:2=마스터, 3=조수, 4=노예, 5=고객 백의 위:1=질에서의임신, 2=애널에서의임신)
;102→마스터에 의한 나카타씨 카운트용
;103→조수에 의한 나카타씨 카운트용
;104→노예에게 의한 나카타씨 카운트용
;105→창관 따위의 손님과 노예 사이의 나카타씨 카운트용
;106→뿌리고 장소 판별 플래그
;107→사용이 끝난콘돔판정(콘돔정음에 사용)
;108→피임결계의 사용의 유무(파일외에서 사용)
;109→배란유발제의 사용의 유무
;110→출산일
;111→부친의 고유 번호(고객은-1이 격납)

;702→마스터에 의한 나카타씨 카운트용
;703→조수에 의한 나카타씨 카운트용
;704→노예에게 의한 나카타씨 카운트용
;705→창관 따위의 손님과 노예 사이의 나카타씨 카운트용
;


;FLAG
;97→임월 or육아중의 노예는 있을까?
;98→사정개소 선택 기능 및임신기능의 ON·OFF
;99→사정선택의 자동 모드시사정처 선택 기능의 ON·OFF

;TFLAG
;700→육아 방커맨드 실행했어?

;---------------------------------------------------------
;eraheta용 변경
;---------------------------------------------------------
;음란시의 부친과의 궁합에 의한 스트레스 경감 처리를 변경
;육아실 판정의 변경(육아 기간이 30일이 되어 있었다)
;입상표시시의 ASSI 번호 보존 처리 삭제(필요하다고는 생각되지 않기 때문에)

;임신발각 처리의 GET_CHILD계가 어떻게도 이상했기 때문에 통째로 변경
;하는 김에 주인도임신 하도록(듯이) 마개조…… 어째서 이렇게 되었다

;---------------------------------------------------------
;eraTolove용 변경
;---------------------------------------------------------
;애널로 임신할 수 있도록(듯이)임신체크나임신처리를 개조
;1문자 변수를 가능한 한 옮겨놓았습니다
;PREGNANT		체크·처리 대상 캐릭터의 등록 번호를 격납
;EJAC_FLAG		질 쏘아 맞히고·장 쏘아 맞히고를 격납하고 있는 CFLAG
;FATHER			부친의 등록 번호를 격납
;FERTILITY		배란유발제·발정기의 경우의임신체크시 용의 값을 격납

;---------------------------------------------------------
;나카타씨·임신플래그에 관련되는 함수군
;---------------------------------------------------------
@IN_VAGINA_ANAL_ALL
FOR PREGNANT, 0, CHARANUM
	;임신판정(임신 하고 있으면 102-105나 702-705가 RESULT에 격납)
	CALL PREGNANCY_CHECK
	;부친의 고유 번호 기록(마스터=2조수=3 노예=4 불명=5)
	;임신 하고 있지 않는 경우는 through될 것
	SELECTCASE (RESULT % 100)
		;부친이 주인
		CASE 2
			CFLAG:PREGNANT:111 = NO:MASTER
		;부친이 조수
		CASE 3
			CFLAG:PREGNANT:111 = NO:ASSI
		;부친이 노예
		CASE 4
			CFLAG:PREGNANT:111 = NO:TARGET
		;부친이 고객(-1을 격납)
		CASE 5
			CFLAG:PREGNANT:111 = -1
		;임신 하고 있지 않으면 다음의 루프에
		CASEELSE
			CONTINUE
	ENDSELECT
	;출산 예정일을 설정
	CFLAG:PREGNANT:110 = DAY + 60 + RAND:6
	;현재의아이의 수플래그＋
	FLAG:33++
NEXT
;나카타씨 카운트를 클리어
CVARSET CFLAG, 102, 0
CVARSET CFLAG, 103, 0
CVARSET CFLAG, 104, 0
CVARSET CFLAG, 105, 0

;장 쏘아 맞히고 카운트 클리어
CVARSET CFLAG, 702, 0
CVARSET CFLAG, 703, 0
CVARSET CFLAG, 704, 0
CVARSET CFLAG, 705, 0

@PREGNANCY_CHECK
;질 쏘아 맞히고·장 쏘아 맞혀에 의한임신, 비임신의 체크
;질 쏘아 맞히고·장 쏘아 맞히고 1~10까지는 5새겨, 10~50까지는 10 잘게 썰기로 확률이 상승한다. 50~100까지는 일률. 매회 리셋트.
;작은 몸집 체계는임신 하기 어렵다.

;임신확정·임신중·육아중라면 함수 종료
SIF CFLAG:PREGNANT:110 > 0 || TALENT:PREGNANT:임신 || TALENT:PREGNANT:육아중
	RETURN 0
	
;남자·반음반양·컨트보이로오메가소유가 아니면 함수 종료
SIF MALE(PREGNANT) && TALENT:PREGNANT:오메가 == 0
	RETURN 0
	
;소인체형라면 함수 종료
SIF TALENT:PREGNANT:소인체형
	RETURN 0

;아이의 수가 너무 많다면 함수 종료
SIF FLAG:33 >= 10
	RETURN 0
	

;EJAC_FLAG =체크하는 플래그 CFLAG:102-105, 혹은 CFLAG:702-705
FOR EJAC_FLAG, 2, 5
	
	;조수가 없는 경우 노예가 없는 경우는 다음의 플래그까지 처리를 날린다
	SIF (EJAC_FLAG == 3 && ASSI < 0) || (EJAC_FLAG == 4 && TARGET < 0)
		CONTINUE
	
	;남자라면 장 쏘아 맞히고(CFLAG:702-705)를 본다
	IF MALE(PREGNANT)
		EJAC_FLAG += 700
	;그 이외라면 질 쏘아 맞히고(CFLAG:102-105)를 본다
	ELSE
		EJAC_FLAG += 100
	ENDIF
	
	
	;질 쏘아 맞히고·장 비쳐지지 않으면 다음의 플래그의 체크에
	SIF CFLAG:PREGNANT:EJAC_FLAG == 0
		CONTINUE

	;배란유발제·발정기의 정수를 설정
	;FERTILITY는 4(초기치)인가 2나 1이 설정된다
	;배란유발제
	FERTILITY = 4
	FERTILITY -= CFLAG:PREGNANT:109 * 2
	;발정기
	SIF TALENT:PREGNANT:발정기
		FERTILITY -= (TALENT:PREGNANT:발정기)

	IF CFLAG:PREGNANT:EJAC_FLAG >= 1 && CFLAG:PREGNANT:EJAC_FLAG < 5
		SIF RAND:((8 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ELSEIF CFLAG:PREGNANT:EJAC_FLAG >= 5 && CFLAG:PREGNANT:EJAC_FLAG < 10
		SIF RAND:((7 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ELSEIF CFLAG:PREGNANT:EJAC_FLAG >= 10 && CFLAG:PREGNANT:EJAC_FLAG < 20
		SIF RAND:((6 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ELSEIF CFLAG:PREGNANT:EJAC_FLAG >= 20 && CFLAG:PREGNANT:EJAC_FLAG < 30
		SIF RAND:((5 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ELSEIF CFLAG:PREGNANT:EJAC_FLAG >= 30 && CFLAG:PREGNANT:EJAC_FLAG < 40
		SIF RAND:((4 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ELSEIF CFLAG:PREGNANT:EJAC_FLAG >= 40 && CFLAG:PREGNANT:EJAC_FLAG < 50
		SIF RAND:((3 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ELSEIF CFLAG:PREGNANT:EJAC_FLAG >= 50
		SIF RAND:((2 + TALENT:PREGNANT:작은체구 * 2) * FERTILITY) == 0
			CFLAG:PREGNANT:101 = EJAC_FLAG
	ENDIF

	;임신디버그 플래그
	SIF FLAG:151
		CFLAG:PREGNANT:101 = EJAC_FLAG
		
	;임신확정하면 루프를 빠진다
	SIF CFLAG:PREGNANT:101 > 0
		BREAK
NEXT

RETURN CFLAG:PREGNANT:101

;---------------------------------------------------------
;임신처리 함수군
;---------------------------------------------------------
@GET_CHILD_ALL
;캐릭터의임신발각시의 처리
FOR PREGNANT, 0, CHARANUM
	;대상이임신중·육아중·노역중이 아닌가 개출산일까지 54일 이내 한편 임신가 확정되어 있다
	IF !TALENT:PREGNANT:임신 && !TALENT:PREGNANT:육아중 && !CFLAG:PREGNANT:12 && CFLAG:PREGNANT:110 <= DAY+54 && CFLAG:PREGNANT:101 > 0
	;상기의 조건에 걸리면 다음의 캐릭터에게
	ELSE
		CONTINUE
	ENDIF
	;부친을 FATHER로 한다(없으면-1)
	FATHER = GETCHARA(CFLAG:PREGNANT:111)
	IF PREGNANT == MASTER || PREGNANT == 0
		PRINTW 아무래도 컨디션이 이상하다……
	ELSE
		PRINTFORMW %CALLNAME:PREGNANT%의 모습이 이상하다……
	ENDIF
	IF CFLAG:PREGNANT:111 >= 0 && FATHER >= 0
		PRINTFORML %CALLNAME:PREGNANT%는 %CALLNAME:FATHER%의아이를 임신한 것 같다
	ELSEIF CFLAG:PREGNANT:101 % 100 == 5
		PRINTFORML %CALLNAME:PREGNANT%는 이름도 모르는 남자의아이를 임신한 것 같다
	ELSEIF (CFLAG:PREGNANT:111 > 0 && CFLAG:PREGNANT:111 < 890) && EXISTCSV(CFLAG:PREGNANT:111, 0)
		PRINTFORML %CALLNAME:PREGNANT%는%CSVCALLNAME(CFLAG:PREGNANT:111, 0)%의아이를 임신하고 있던 것 같다
	ELSE
		PRINTFORML %CALLNAME:PREGNANT%는 요전날 매각한 노예의아이를 임신하고 있던 것 같다
	ENDIF
	PRINTFORMW %CALLNAME:PREGNANT%는[%TALENTNAME:153%]했다
	TALENT:PREGNANT:임신 = 1
	EXP:PREGNANT:임신경험 += 1
	PRINTL EXP:임신경험＋1
	CALL CHANGE_N_STATUS
NEXT

@CHANGE_N_STATUS
;임신시의 스테이터스의 변화
;공통 처리
;체력상한을 줄인다
;체력가 상한 넘는 일도 있으므로, 체력 501 이상이라면 500으로 한다
MAXBASE:PREGNANT:체력 -= 500
IF BASE:PREGNANT:체력 >= 501
	BASE:PREGNANT:체력 = 500
	IF PREGNANT == MASTER
		PRINTFORMW 어쩐지 심하게 지쳤다……
	ELSE
		PRINTFORMW 심하게 피곤한 것 같다… 쉬게 하는 것이 좋을 것이다
	ENDIF
	PRINTFORMW 　
ENDIF

;남자·반음반양·컨트보이가 아니다
IF MALE(PREGNANT) == 0
	;젖이 원 랭크 파워업 한다
	;절→빈빈→보보→거거·폭→그대로
	;가슴의 사이즈 관련의 소질을 CFLAG:23에 보존(1으로 표준, 다른 것은 TALENT 번호 그대로)
	IF TALENT:PREGNANT:절벽 == 1
		PRINTFORMW %CALLNAME:PREGNANT%의가슴가 %TALENTNAME:110%로부터 %TALENTNAME:109% 정도에 커졌다
		CFLAG:PREGNANT:23 = 110
		TALENT:PREGNANT:절벽 = 0
		TALENT:PREGNANT:빈유 = 1
	ELSEIF TALENT:PREGNANT:빈유 == 1
		PRINTFORMW %CALLNAME:PREGNANT%의가슴가 %TALENTNAME:109%로부터 보통 정도로 크게 되었다
		PRINTFORMW 　
		CFLAG:PREGNANT:23 = 109
		TALENT:PREGNANT:빈유 = 0
	ELSEIF TALENT:PREGNANT:거유 == 0 && TALENT:PREGNANT:폭유 == 0
		PRINTFORMW %CALLNAME:PREGNANT%의가슴가 보통 정도로부터 %TALENTNAME:111% 정도에 커졌다
		PRINTFORMW 　
			CFLAG:PREGNANT:23 = 1
		TALENT:PREGNANT:거유 = 1
	ELSEIF TALENT:PREGNANT:폭유
		CFLAG:PREGNANT:23 = 112
	ELSEIF TALENT:PREGNANT:거유
		CFLAG:PREGNANT:23 = 111
	ENDIF
ENDIF

;모유 나오게 된다
IF TALENT:PREGNANT:모유체질 == 0 && (((FLAG:2 & 256) == 0 && (BREAST(TARGET) || TALENT:절벽)) || (FLAG:2 & 256))
	PRINTFORMW %CALLNAME:PREGNANT%는모유가 나오게 되었다
	PRINTFORMW 　
	TALENT:PREGNANT:모유체질 = 1
ENDIF

SIF PREGNANT == MASTER
	RETURN 0

;부친이 누구인 것일까하고 모친 상태에 의한 스트레스치의 분기
;음란시의 궁합에 의한 스트레스 경감 처리
A = FATHER
R = 10
IF CFLAG:PREGNANT:111 >= 0 && FATHER >= 0
	IF RELATION:PREGNANT:FATHER != 0
		R = RELATION:FATHER:FATHER / 10
	ENDIF
ENDIF

;모친이 미함락
IF !KANRAKU2(PREGNANT)
	CFLAG:PREGNANT:10 += 100 - EXP:PREGNANT:출산경험 * 5 - TALENT:PREGNANT:모성 * 5 - TALENT:PREGNANT:아이좋아 * 5
;부친이 고객
ELSEIF CFLAG:PREGNANT:101 % 100 == 5
	;모친이복종함락
	IF KANRAKU2(PREGNANT) == 3
		CFLAG:PREGNANT:10 += 20
	;모친이연모함락
	ELSEIF KANRAKU2(PREGNANT) == 1
		CFLAG:PREGNANT:10 += 50 - EXP:PREGNANT:출산경험 * 5 - TALENT:PREGNANT:모성 * 5 - TALENT:PREGNANT:아이좋아 * 5
	;모친이음란함락
	ELSE
		CFLAG:PREGNANT:10 +=  30 - EXP:PREGNANT:출산경험 * 5 - TALENT:PREGNANT:모성 * 5 - TALENT:PREGNANT:아이좋아 * 5
	ENDIF
;모친이음란함락
ELSEIF KANRAKU2(PREGNANT) == 2
	CFLAG:PREGNANT:10 += 40 / R - EXP:PREGNANT:출산경험 * 5 - TALENT:PREGNANT:모성 * 5 - TALENT:PREGNANT:아이좋아 * 5
;부친이 매각된 원사모·공포 대상
ELSEIF CFLAG:PREGNANT:38 > 0 && CFLAG:PREGNANT:111 == CFLAG:PREGNANT:38
	CFLAG:PREGNANT:10 -= 50
;모친이복종함락
ELSEIF KANRAKU2(PREGNANT) == 3
	;공포 대상이 부친
	IF CFLAG:PREGNANT:41 == NO:FATHER
		CFLAG:PREGNANT:10 += 0
	;그 이외
	ELSE
		CFLAG:PREGNANT:10 += 20
	ENDIF
;모친이연모함락
ELSE
	;사모 대상이 부친
	IF CFLAG:PREGNANT:41 == NO:FATHER
		CFLAG:PREGNANT:10 -= 50
	;그 이외
	ELSE
		CFLAG:PREGNANT:10 += 50
	ENDIF
ENDIF

SIF CFLAG:PREGNANT:10 < 0
	CFLAG:PREGNANT:10 = 0

;스트레스치의 누적이 100을 넘었을 경우
IF CFLAG:PREGNANT:10 >= 100 && TALENT:PREGNANT:붕괴 == 0
	TFLAG:13 = 52
	;입카미분기플래그
	TFLAG:53 = 2
	LOCAL = TARGET
	TARGET = T
	;사랑이 없는임신 취급해 되어 버리므로, 부친을 호출해 보겠습니다
	IF CFLAG:PREGNANT:111 >= 0 && FATHER >= 0
		PRINTFORMW %CALLNAME:MASTER%는 부친인 %CALLNAME:FATHER%를 호출해,%CALLNAME%에임신를 고하게 했다
		LOCAL:3 = MASTER
		MASTER = FATHER
		CALL MASTER_CHANGE_OFF
		CALL MASTER_CHANGE_ON
	ENDIF
	CALL KOJO_MESSAGE_EVENT
	TARGET = LOCAL
	IF CFLAG:PREGNANT:111 >= 0 && FATHER >= 0
		MASTER = LOCAL:3
		CALL MASTER_CHANGE_OFF
		CALL MASTER_CHANGE_ON
	ENDIF
	;부적가 있으면 부활
	IF CFLAG:PREGNANT:693 || CFLAG:PREGNANT:694
		TFLAG:13 = 72
		CALL KOJO_MESSAGE_EVENT
		IF CFLAG:PREGNANT:694
			CFLAG:PREGNANT:10 = 0
			CFLAG:PREGNANT:694 -= 1
		ELSE
			CFLAG:PREGNANT:10 = 90
			CFLAG:PREGNANT:693 -= 1
		ENDIF
	ELSE
		IF KANRAKU(PREGNANT) && CFLAG:PREGNANT:10 >= 100
			PRINTFORMW %CALLNAME:PREGNANT%는[%TALENTNAME:(CFLAG:PREGNANT:39)%]를 잃었다
			TALENT:PREGNANT:연모 = 0
			TALENT:PREGNANT:음란 = 0
			TALENT:PREGNANT:복종 = 0
			TALENT:PREGNANT:친애 = 0
			TALENT:PREGNANT:창부 = 0
			TALENT:PREGNANT:예속 = 0
		ENDIF
		SIF CFLAG:PREGNANT:10 >= 100
			TALENT:PREGNANT:붕괴 = 1
	ENDIF
ENDIF

;조수·노예에게 의해임신
IF CFLAG:PREGNANT:101 % 100 == 3 || CFLAG:PREGNANT:101 % 100 == 4
	W = FATHER
ENDIF
;현재의 조교 대상의 퇴피
V = TARGET
TARGET = PREGNANT
;여기서의 A는 CFLAG:PREGNANT:38에 들어가 있는지를 판정하므로 부친의 고유 번호
A = CFLAG:PREGNANT:111
;임신발각시의 이벤트입상
TFLAG:13 = 11
CALL KOJO_MESSAGE_EVENT
;조교 대상을 되돌린다
TARGET = V
;조수·노예에게 의해임신
IF CFLAG:PREGNANT:101 % 100 == 3 || CFLAG:PREGNANT:101 % 100 == 4
	FATHER = W
ENDIF

;임월 도달
@REACH_FULL_TERM
PREGNANT = COUNT
PRINTFORML %CALLNAME:PREGNANT%는 임월을 맞이했습니다
PRINTFORMW %CALLNAME:PREGNANT%는 출산에 준비 육아실에 이동합니다
SIF TARGET == PREGNANT
	TARGET = -1
SIF ASSI == PREGNANT
	ASSI = -1
;이벤트 캔슬 플래그
SIF !CFLAG:PREGNANT:42
	CFLAG:PREGNANT:42 = 2
;주인의 경우 그대로 출산까지의 일수를 스킵
IF MASTER == PREGNANT
	PRINTFORMW 그 3일후……
	PRINTFORMW …
	PRINTFORMW …
	PRINTFORMW ·
	DAY += 3 + 1
	C = MASTER
	CALL CHILD_BIRTH
ENDIF

;출산
@CHILD_BIRTH
PREGNANT = C
FATHER = GETCHARA(CFLAG:PREGNANT:111)
LOCAL = FATHER
IF CFLAG:C:111 >= 0 && FATHER > -1
	PRINTFORML %CALLNAME:PREGNANT%는,%CSVCALLNAME(CFLAG:PREGNANT:111, 0)%의아이를 무사히 출산했습니다
ELSE
	PRINTFORML %CALLNAME:PREGNANT%는아이를 무사히 출산했습니다
ENDIF
PRINTL 
;질로 임신한다
IF CFLAG:PREGNANT:101 / 100 == 1
	PRINTL V확장경험＋10
	EXP:PREGNANT:V확장경험 += 10
;애널로 임신한다
ELSEIF CFLAG:PREGNANT:101 / 100 == 7
	PRINTL A확장경험＋10
	EXP:PREGNANT:A확장경험 += 10
ENDIF
PRINTL 출산경험＋1
EXP:PREGNANT:출산경험 += 1

PRINTW 
IF PREGNANT == MASTER && FATHER >= 0
	PRINTFORML %CALLNAME:MASTER%는, %CALLNAME:FATHER%를 호출해아이의 얼굴을 보여 주었다
	PRINTFORM %CALLNAME:FATHER%는
	IF (TALENT:FATHER:연모 || TALENT:FATHER:친애) && CFLAG:FATHER:41 == NO:MASTER
		PRINTL 매우 행복하게아이의 얼굴을 들여다 보고 있다
	ELSEIF TALENT:FATHER:음란 || TALENT:FATHER:창부
		PRINTFORML 이것으로 또 %CALLNAME:MASTER%과 기분 좋은 일을 할 수 있으면 기뻐하고 있다
	ELSEIF (TALENT:FATHER:복종 || TALENT:FATHER:예속) && CFLAG:FATHER:41 == NO:MASTER
		PRINTFORML %CALLNAME:MASTER%가 무사해서 좋았다고 안도하고 있다
	ELSE
		PRINTL 복잡한 표정으로 2명을 내려다 보고 있다……
	ENDIF
	;반발각인가 있으면 1 감소
	IF MARK:FATHER:반발각인 >= 1
		MARK:FATHER:반발각인 -= 1
		PRINTFORML %CALLNAME:FATHER%의 %MARKNAME:3%가 Lv{MARK:반발각인}가 되었다
	ENDIF
ELSE
	T = TARGET
	TARGET = PREGNANT
	;사랑이 없는임신 취급해 되어 버리므로, 부친을 호출해 보겠습니다
	IF CFLAG:PREGNANT:111 >= 0 && FATHER > -1
		IF MASTER == FATHER
			PRINTFORMW %CALLNAME:MASTER%는 문병하러 가기로 했다
		ELSE
			PRINTFORMW %CALLNAME:MASTER%는 부친인 %CALLNAME:FATHER%에%CALLNAME%를 문병하게 했다
		ENDIF
		LOCAL:3 = MASTER
		MASTER = FATHER
		CALL MASTER_CHANGE_OFF
		CALL MASTER_CHANGE_ON
	ENDIF
	;출산시의 이벤트입상
	TFLAG:13 = 12
	CALL KOJO_MESSAGE_EVENT
	TARGET = T
	IF CFLAG:PREGNANT:111 >= 0 && FATHER > -1
		MASTER = LOCAL:3
		CALL MASTER_CHANGE_OFF
		CALL MASTER_CHANGE_ON
	ENDIF
ENDIF

;임신를 잃는다
TALENT:PREGNANT:임신 = 0

$INPUT_LOOP
;육아 방폐[放棄]를 했을 경우(주인 출산의 경우도 육아 방폐[放棄])
IF TALENT:PREGNANT:붕괴 || PREGNANT == MASTER
	;육아 방폐[放棄]때의 갓난아이의 처치
	A = 0
	REPEAT CHARANUM
		SIF COUNT != MASTER && !TALENT:COUNT:임신 && (TALENT:COUNT:육아중 || TALENT:COUNT:모성) && CFLAG:COUNT:12 == 0
			A += 1
	REND
	IF A > 0
		PRINTFORMW 출생한 갓난아기를 다른 노예에게 맡기는지, 수양 자식에게 내는지를 선택해 주세요
		PRINTW 
		PRINTL 누구에게 맡깁니까?
		REPEAT CHARANUM
			;주인 이외로 현재[임신]상태가 아니고,[육아중]나[모성]소유로 노역중이 아닌 캐릭터를 나열
			SIF COUNT != MASTER && !TALENT:COUNT:임신 && (TALENT:COUNT:육아중 || TALENT:COUNT:모성) && CFLAG:COUNT:12 == 0
				PRINTFORML [{COUNT, 2}]%NAME:COUNT% 
		REND
		PRINTFORML  [100]수양 자식에게 낸다
		INPUT
		IF RESULT == 100
			PRINTFORMW %CALLNAME:MASTER%는 부득이, 갓난아기를 수양 자식에게 냈습니다
			;현재의아이의 수플래그
			FLAG:33--
		ELSEIF RESULT < 0 || RESULT >= CHARANUM
			GOTO INPUT_LOOP
		ELSEIF COUNT == MASTER || TALENT:RESULT:임신 || (!TALENT:RESULT:육아중 && !TALENT:RESULT:모성) && CFLAG:RESULT:12 == 0
			GOTO INPUT_LOOP
		ENDIF
		IF RESULT != 100
			PRINTFORMW %CALLNAME:MASTER%는 %CALLNAME:RESULT%에 유모를 해 받기로 했습니다
			;육아 기간을 설정한다
			CFLAG:RESULT:110 = DAY
			IF !TALENT:RESULT:육아중
				TALENT:RESULT:육아중 = 1
				SIF RESULT == TARGET
					TARGET = -1
				SIF RESULT == ASSI
					TARGET = -1
			ENDIF
			;heta용 아가씨 패치
			CALL CHILD_CHECK(PREGNANT, LOCAL, RESULT)
		ENDIF
	ELSE
		PRINTFORMW %CALLNAME:MASTER%는 부득이, 갓난아기를 수양 자식에게 냈습니다
		;현재의아이의 수플래그
		FLAG:33--
	ENDIF
	;임신시로 감소한체력의 최대치가 회복
	MAXBASE:PREGNANT:체력 += 500
	CALL CLEAR_FLAG
	;임신시에 커진가슴의 사이즈를 일단 작게 한다
	CALL REVERSE_B_SIZE

;육아에게 들어왔을 경우
ELSE
	PRINTFORML %CALLNAME:PREGNANT%는 육아실에서 육아를 시작했다
	TALENT:PREGNANT:육아중 = 1
	;연모·친애소유로 부친이 사모 대상
	IF KANRAKU2(PREGNANT) == 1 && CFLAG:PREGNANT:111 == CFLAG:PREGNANT:41 && TALENT:PREGNANT:모성 == 0
		PRINTFORM 아무래도 %CALLNAME:PREGNANT%는[
		PRINTS TALENTNAME:155
		PRINTW ]에 눈을 뜬 것 같다
		TALENT:PREGNANT:모성 = 1
	ENDIF
	;heta용 아가씨 패치
	CALL CHILD_CHECK(PREGNANT, LOCAL)
ENDIF


@CHILD_CARE_ROOM(ARG, ARG:1)
SIF ARG:1
	PRINTFORML %CALLNAME:ARG%는아이의 상태를 보러 왔다
PRINTL 어느 방에 상태를 보러 갑니까?
VARSET LOCAL
IF ARG:1
	LOCAL:5 = MASTER
	MASTER = ARG
	CALL MASTER_CHANGE_OFF
	CALL MASTER_CHANGE_ON
ENDIF
REPEAT CHARANUM
	IF COUNT == MASTER
		CONTINUE
	;현재 임월이나[육아중]의 캐릭터를 나열, 한 번 방문하면 지운다
	ELSEIF !LOCAL:(10 + COUNT) && ((TALENT:COUNT:임신 && (CFLAG:COUNT:110 - 3) <= DAY) || TALENT:COUNT:육아중)
		;육아중의 경우, 기르고 있는아이를 검색 친자식을 우선해 표시한다
		IF TALENT:COUNT:육아중
			FOR LOCAL, 1, CHARANUM
				IF CFLAG:LOCAL:115 == NO:COUNT && CFLAG:LOCAL:116
					;LOCAL:1에 아직 친자식이 들어가 있지 않으면아이의 등록 번호를 넣는다
					SIF !LOCAL:2
						LOCAL:1 = LOCAL
					;아이가 친자식의 경우, 친자식 플래그를 세운다
					IF CFLAG:COUNT:114 == NO:LOCAL
						LOCAL:2 += 1
					;아이가 양자의 경우, 양자 플래그를 세운다
					ELSE
						LOCAL:3 += 1
					ENDIF
				ENDIF
			NEXT
		ENDIF
		PRINTFORM [{COUNT, 2}]%CALLNAME:COUNT%
		IF TALENT:COUNT:육아중
			PRINTFORML 와 %CALLNAME:(LOCAL:1)%\@ LOCAL:2 + LOCAL:3 >= 2? 들 # \@
		ELSE
			PRINTL 
		ENDIF
	ENDIF
REND
PRINTFORML [1000]돌아온다

$INPUT_LOOP
INPUT
IF RESULT == 1000
	IF ARG:1
		MASTER = LOCAL:5
		CALL MASTER_CHANGE_OFF
		CALL MASTER_CHANGE_ON
	ENDIF
	RETURN 0
ELSEIF RESULT < 0 || RESULT >= CHARANUM
	GOTO INPUT_LOOP
ELSEIF RESULT == MASTER
	GOTO INPUT_LOOP
ELSEIF !TALENT:RESULT:임신 && (CFLAG:RESULT:110 - 3) <= DAY && !TALENT:RESULT:육아중
	GOTO INPUT_LOOP
ELSE
	;육아중의 경우, 기르고 있는아이를 검색 친자식을 우선해 표시한다
	LOCAL = 0
	LOCAL:1 = 0
	LOCAL:2 = 0
	LOCAL:3 = 0
	IF TALENT:RESULT:육아중
		FOR LOCAL, 1, CHARANUM
			IF CFLAG:LOCAL:115 == NO:RESULT && CFLAG:LOCAL:116
				;LOCAL:1에 아직 친자식이 들어가 있지 않으면아이의 등록 번호를 넣는다
				SIF !LOCAL:2
					LOCAL:1 = LOCAL
				;아이가 친자식의 경우, 친자식 플래그를 세운다
				IF CFLAG:RESULT:114 == NO:LOCAL
					LOCAL:2 += 1
				;아이가 양자의 경우, 양자 플래그를 세운다
				ELSE
					LOCAL:3 += 1
				ENDIF
			ENDIF
		NEXT
	ENDIF
	PRINTFORM %CALLNAME:MASTER%는 %CALLNAME:RESULT%
	SIF TALENT:RESULT:육아중
		PRINTFORM 와 %CALLNAME:(LOCAL:1)%\@ LOCAL:2 + LOCAL:3 > 1? 들 # \@
	PRINTL 에 향했다
	PRINTW 
	;방문이 끝난 상태
	LOCAL:(10 + RESULT)++
	;육아실의 이벤트입상
	A = TARGET
	TARGET = RESULT
	TFLAG:13 = 13
	CALL KOJO_MESSAGE_EVENT
	TARGET = A
	PRINTL 
	RESTART
ENDIF


RETURN 1


;자립
@DEPEARENT
VARSET LOCAL
LOCAL:3 = NO2(CFLAG:C:115)
PRINTFORML %CALLNAME:(LOCAL:3)%가 기르고 있던 %NAME:C%가 자립 했습니다
;아이의 성장 플래그, 소질을 클리어
CFLAG:C:26 = 0
CFLAG:C:116 = 0
;그 밖에 기르고 있는아이가 없는가 검색
FOR LOCAL:1, 0, CHARANUM
	SIF CFLAG:(LOCAL:1):115 == CFLAG:C:115 && CFLAG:(LOCAL:1):116
		LOCAL:2++
NEXT
PRINTW 
LOCAL = ASSI
ASSI = C
PREGNANT = LOCAL:3
;그 밖에 기르고 있는 아이가 없으면, 어머니(유모)는 조교 복귀
IF !LOCAL:2
	PRINTFORMW %CALLNAME:PREGNANT%는 다시 조교 가능하게 되었습니다
	;임신시로 감소한체력의 최대치가 회복
	MAXBASE:PREGNANT:체력 += 500
	TALENT:PREGNANT:육아중 = 0
	IF !TALENT:PREGNANT:빈유 && !TALENT:PREGNANT:절벽
		SIF BREAST(PREGNANT)
			PRINTFORMW %CALLNAME:PREGNANT%의가슴는모유를 주는 역할을 끝낸 것으로 작아졌습니다
		;임신시에 커진가슴의 사이즈를 일단 작게 한다
		CALL REVERSE_B_SIZE
	ENDIF
	CALL CLEAR_FLAG
ENDIF

;기르는지 아닌지
$CHILD
PRINTFORMW %CALLNAME:ASSI%는 훌륭하게 성장했습니다
PRINTFORML 손바탕으로 두어 조교합니까?
PRINTL 
PRINTL [0] 독립시킨다
PRINTL [1] 손바탕으로 두어 조교한다
PRINTFORML [2] %CALLNAME:ASSI%의 능력을 본다
$INPUT_LOOP
INPUT
IF RESULT == 0
	;자립시의 이벤트입상
	TFLAG:13 = 14
	LOCAL:1 = TARGET
	TARGET = C
	CALL KOJO_MESSAGE_EVENT
	TARGET = LOCAL:1
	LOCAL:2 = ASSI
	;손바탕으로 번호 덮어 쓰는 것의 다른아이가 있을지 어떨지 체크
	REPEAT CHARANUM
		SIF COUNT != ASSI && NO:COUNT == NO:ASSI
			LOCAL:4 = COUNT
	REND
	;자립 하는아이에 대한 궁합을 리셋트
	IF !LOCAL:4
		REPEAT CHARANUM
			RELATION:COUNT:(NO:ASSI) = 0
		REND
	ENDIF
	DELCHARA LOCAL:2
	IF LOCAL > LOCAL:2
		ASSI = (LOCAL - 1)
	ELSE
		ASSI = LOCAL
	ENDIF
	SIF MASTER > LOCAL:2
		MASTER -= 1
	SIF TARGET > LOCAL:2
		TARGET -= 1
	;현재의아이의 수플래그─
	FLAG:33--
ELSEIF RESULT == 1
	TARGET = C
	;손바탕으로 둘 때의 이벤트입상
	TFLAG:13 = 45
	CALL KOJO_MESSAGE_EVENT
	TARGET = ASSI
	ASSI = -1
ELSEIF RESULT == 2
	CALL PRINT_STATUS(ASSI)
	GOTO CHILD
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF

;임신패치 주위의 플래그를 리셋트
@CLEAR_FLAG
SIF CFLAG:PREGNANT:42 == 2
	CFLAG:PREGNANT:42 = 0
CFLAG:PREGNANT:101 = 0
CFLAG:PREGNANT:102 = 0
CFLAG:PREGNANT:103 = 0
CFLAG:PREGNANT:104 = 0
CFLAG:PREGNANT:105 = 0
CFLAG:PREGNANT:110 = 0
CFLAG:PREGNANT:111 = 0
CFLAG:PREGNANT:114 = 0
CFLAG:PREGNANT:702 = 0
CFLAG:PREGNANT:703 = 0
CFLAG:PREGNANT:704 = 0
CFLAG:PREGNANT:705 = 0


;육아 종료 or임신강제 종료시의가슴사이즈의 축소 처리
@REVERSE_B_SIZE
;폭→거거→보보→빈빈·절→그대로
;CFLAG:23이 있으면가슴의 사이즈 관련의 소질을 복귀
IF CFLAG:PREGNANT:23 == 0
	IF TALENT:PREGNANT:폭유
		TALENT:PREGNANT:폭유 = 0
		TALENT:PREGNANT:거유 = 1
	ELSEIF TALENT:PREGNANT:거유
		TALENT:PREGNANT:거유 = 0
	ELSEIF TALENT:PREGNANT:빈유 == 0 && TALENT:PREGNANT:절벽 == 0
		TALENT:PREGNANT:빈유 = 1
	ENDIF
ELSEIF CFLAG:PREGNANT:23 >= 109 && CFLAG:PREGNANT:23 <= 112
	A = CFLAG:PREGNANT:23
	TALENT:PREGNANT:A = 1
ELSEIF CFLAG:PREGNANT:23 == 1
	TALENT:PREGNANT:폭유 = 0
	TALENT:PREGNANT:거유 = 0
ENDIF

;육아실에 있을까의 판정
@CHECK_CHILD_CARE
SIF (TALENT:C:임신 && CFLAG:C:110 - 3 <= DAY) || TALENT:C:육아중
	RETURN 1

RETURN 0

