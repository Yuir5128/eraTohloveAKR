;===========================================================
;EVENT_T.ERB, EVENT_TRAIN, 조교시 및 조교 전후의 이벤트
;===========================================================
@EVENTTRAIN
#PRI

;-------------------------------------------------
;게이지의 초기치와 한계수확보
;-------------------------------------------------
;사정의 초기치는 0
BASE:사정 = 0
BASE:PLAYER:사정 = 0
SIF ASSI >= 0
	BASE:ASSI:사정 = 0
;사정한계수의 확보
REPEAT CHARANUM
	IF COUNT == MASTER
		CFLAG:COUNT:11 = 10
	ELSEIF COUNT == ASSI
		CFLAG:COUNT:11 = 10
	ELSEIF COUNT == TARGET
		CFLAG:COUNT:11 = 10
	ENDIF
	SIF TALENT:COUNT:절륜
		CFLAG:COUNT:11 += 10
	SIF TALENT:COUNT:말자지
		CFLAG:COUNT:11 += 3
REND
;사정플래그, 처녀상실 플래그 따위를 리셋트
REPEAT 200
	TFLAG:COUNT = 0
REND

;모유
BASE:모유 = 0
BASE:PLAYER:모유 = 0
SIF ASSI >= 0
	BASE:ASSI:모유 = 0

;뇨의
BASE:뇨의 = 10
BASE:PLAYER:뇨의 = 10
SIF ASSI >= 0
	BASE:ASSI:뇨의 = 10

;변의
BASE:변의 = 10
BASE:PLAYER:변의 = 10
SIF ASSI >= 0
	BASE:ASSI:변의 = 10

;구역질
BASE:구역질 = 10
BASE:PLAYER:구역질 = 10
SIF ASSI >= 0
	BASE:ASSI:구역질 = 10


;질내에바기나더러움을 부가
SIF VAGINA(TARGET)
	STAIN:질내 |= 1
SIF VAGINA(MASTER)
	STAIN:MASTER:질내 |= 1
IF ASSI >= 0
	SIF VAGINA(ASSI)
		STAIN:ASSI:질내 |= 1
ENDIF

;콘돔자동 장착 설정의 리셋트
FLAG:98 = 0

;콘돔사정플래그를 리셋트
CFLAG:107 = 0

;조교자는 누군가
IF ASSIPLAY == 0
	PLAYER = MASTER
ELSE
	PLAYER = ASSI
	ASSI = MASTER
ENDIF

SIF TEQUIP:속옷（아래） == 5
	TEQUIP:정조대 = 1

;남은 시간을 세트
TFLAG:74 = 30

@EVENTTURNEND
#PRI
;매각이나 조수화가 가능하게 되었는지
SIF TARGET < 0
	RETURN 0
SIF ABL:순종 + ABL:욕망 < 6
	RETURN 0
SIF ABL:순종 < 4 && ((TALENT:반항적 && TALENT:복종 == 0 && TALENT:예속 == 0) || TALENT:꿋꿋함)
	RETURN 0
SIF ABL:욕망 < 4 && (TALENT:자제심 || TALENT:억압 || TALENT:저항)
	RETURN 0

IF ABL:기교 >= 3 || ABL:봉사정신 >= 3 || ABL:마조끼 >= 3 || ABL:순종 >= 5 || ABL:욕망 >= 5 || ABL:C감각+ABL:V감각+ABL:A감각+ABL:B감각 >= 13
	IF CFLAG:1 <= 0
		PRINTFORMW %NAME:TARGET%가 매각 가능하게 되었습니다
		CFLAG:1 = 1
	ENDIF
ELSE
	RETURN 0
ENDIF

IF (ABL:순종+ABL:욕망+ABL:기교+ABL:C감각+ABL:레즈끼+ABL:게이끼 >= 12) || (ABL:순종 >=5 && ABL:욕망 >= 4)
	IF CFLAG:1 <= 1
		PRINTFORMW %NAME:TARGET%가 조수 가능하게 되었습니다
		CFLAG:1 = 2
	ENDIF
ENDIF

@EVENTTURNEND
IF TARGET >= 0
	;스트레스치의 가산
	CFLAG:TARGET:10 += 1
	SIF MARK:반발각인 > 2
		CFLAG:TARGET:10 += 1
	
	;스트레스치의 감소(하쿠산이 조수나 주인시만)
	LOCAL = SINGI(TARGET)
	CFLAG:TARGET:10 -= LOCAL
	PRINTL
	SIF LOCAL > 0
		PRINTFORML 하쿠산 요시미츠의 신기가 발동했습니다
	
	;스트레스치 100이상으로붕괴를 얻는다
	SIF CFLAG:TARGET:10 >= 100 && TALENT:붕괴 == 0
		CALL COLLAPSE_MIND_TRAIN
ENDIF

IF ASSI >= 0
	IF TALENT:ASSI:요호 && ITEM:미약 == 0
		PRINTW [요호]의 효과로미약를손에 넣었습니다
		ITEM:미약 = 1
	ENDIF
ENDIF

;소모품의 자동 보충
CALL ITEM_AUTO_SUPPLY

REPEAT 200
	SIF ITEM:COUNT < 0
		ITEM:COUNT = 0
REND

RETURN 0

@ASSI_CHANGE
;[여우]또한기교LV5, C감각LV5로처녀나백버진
IF TALENT:ASSI:여우 && (ABL:ASSI:기교 >= 5 && ABL:ASSI:C감각 >= 5 && ((TALENT:ASSI:처녀 && VAGINA(ASSI)) || (TALENT:ASSI:백버진 && !VAGINA(ASSI))))
	DRAWLINE
	PRINTFORML %NAME:ASSI%는[요호]가 되었다
	DRAWLINE
	WAIT
	TALENT:ASSI:여우 = 0
	TALENT:ASSI:요호 = 1
ENDIF

$INPUT_LOOP
;[이상한뿌리]또한 C감각LV5, 정액중독LV3 이상
IF TALENT:ASSI:반음반양 == 0 &&  TALENT:ASSI:후타나리 == 0 && TALENT:ASSI:이상한뿌리 && (ABL:ASSI:C감각 >= 5 && ABL:ASSI:정액중독 >= 3)
	DRAWLINE
	PRINTFORML …… 아무래도[이상한뿌리]의 효과가 나타날 것 같다
	PRINTFORM %CALLNAME:ASSI%를[
	IF MALE(ASSI)
		PRINT 반음반양
	ELSE
		PRINT 후타나리
	ENDIF
	PRINTL ]로 합니까?
	PRINTL [0] - 한다
	PRINTL [1] - 하지 않는다
	INPUT
	IF RESULT == 0
		C = ASSI
		;CALL FUTANARI
	ELSEIF RESULT == 1
		PRINTFORML %NAME:ASSI%는[이상한뿌리]를 잃었다
		TALENT:ASSI:이상한뿌리 = 0
	ELSE
		GOTO INPUT_LOOP_2
	ENDIF
	DRAWLINE
	WAIT
ENDIF

$INPUT_LOOP_2
;[구현]또한욕망LV5나레즈끼or게이끼LV4 이상
;남자는반음반양, 그렇지 않을 때는후타나리화
IF TALENT:ASSI:반음반양 == 0 &&  TALENT:ASSI:후타나리 == 0 && TALENT:ASSI:구현 && (ABL:ASSI:욕망 >= 5 || ABL:ASSI:레즈끼 >= 4 || ABL:ASSI:게이끼 >= 4)
	DRAWLINE
	PRINTFORML …… 아무래도[구현]의 효과가 나타날 것 같다
	PRINTFORM %CALLNAME:ASSI%를[
	IF MALE(ASSI)
		PRINT 반음반양
	ELSE
		PRINT 후타나리
	ENDIF
	PRINTL ]로 합니까?
	PRINTL [0] - 한다
	PRINTL [1] - 하지 않는다
	INPUT
	IF RESULT == 0
		C = ASSI
		;CALL FUTANARI
	ELSEIF RESULT == 1
		PRINTFORML %NAME:ASSI%는[구현]를 잃었다
		TALENT:ASSI:구현 = 0
	ELSE
		GOTO INPUT_LOOP_2
	ENDIF
	DRAWLINE
	WAIT
ENDIF

ISASSI:ASSI = 1

RETURN 0


@YOUJI
;조교자가유치
IF TALENT:PLAYER:유치
	PRINTS NAME:PLAYER
	PRINT 가 젖을 들이마시는 동안에
	PRINTS NAME:TARGET
	PRINTW 는모유가 나오게 되었다
	TALENT:모유체질 = 1
ENDIF

@EVENTCOMEND

IF VAGINA(TARGET) && TALENT:처녀 && EXP:A경험 > 0 && TALENT:정조관념 && !CFLAG:100
	CFLAG:100 = 1
	PRINTW 정조를 지킬 수 있다면, 조금은후를 꾸짖을 수 있어도 괜찮다고 생각하고 있는 것 같다……
ENDIF

;신기의 처리 스트레스치의 감소치를 돌려준다
@SINGI(ARG)
#FUNCTION
;하쿠산이 주인이 아닌가 개조수가 없다
SIF NO:MASTER != 164 && ASSI < 0
	RETURNF 0
;하쿠산이 주인이 아닌가 개조수가 있다, 다만 하쿠산은 아니다
SIF NO:MASTER != 164 && (ASSI >= 0 && NO:ASSI != 164)
	RETURNF 0
;ARG의 스트레스치가 일정 이하
SIF CFLAG:ARG:10 < 90
	RETURNF 0
;하쿠산의체력이 1000 미만
SIF (NO:MASTER == 164 && BASE:MASTER:체력 < 1000) || (ASSI >= 0 && NO:ASSI == 164 && BASE:ASSI:체력 < 1000)
	RETURNF 0

;최악이어도 5는 회복
LOCAL = 5
;0로부터 5까지 랜덤으로 회복
LOCAL += RAND:6

;기교에 의해 더욱 회복
;하쿠산이 주인
IF NO:MASTER == 164
	LOCAL += ABL:MASTER:기교
	;일률적이어체력를 깎을 수 있다
	BASE:MASTER:체력 -= 500
;하쿠산이 조수
ELSE
	LOCAL += ABL:ASSI:기교
	;일률적이어체력를 깎을 수 있다
	BASE:ASSI:체력 -= 500
ENDIF
RETURNF LOCAL

;조교로【붕괴】를 얻었을 경우의 이벤트
@COLLAPSE_MIND_TRAIN
TFLAG:13 = 52
;입카미분기플래그
TFLAG:53 = 3
CALL KOJO_MESSAGE_EVENT
;부적가 있으면 부활
IF CFLAG:693 || CFLAG:694
	TFLAG:13 = 72
	CALL KOJO_MESSAGE_EVENT
	IF CFLAG:694
		CFLAG:10 = 0
		CFLAG:694 -= 1
	ELSE
		CFLAG:10 = 90
		CFLAG:693 -= 1
	ENDIF
ELSE
	TALENT:붕괴 = 1
	IF CFLAG:39
		PRINTFORM %CALLNAME%는[
		SIF TALENT:연모
			PRINTS TALENTNAME:3
		SIF TALENT:음란
			PRINTS TALENTNAME:4
		SIF TALENT:복종
			PRINTS TALENTNAME:5
		SIF TALENT:친애
			PRINTS TALENTNAME:6
		SIF TALENT:창부
			PRINTS TALENTNAME:7
		SIF TALENT:예속
			PRINTS TALENTNAME:8
		PRINTW ]를 잃었다
	ENDIF
	SIF TALENT:연모
		TALENT:연모 = 0
	SIF TALENT:음란
		TALENT:음란 = 0
	SIF TALENT:복종
		TALENT:복종 = 0
	SIF TALENT:친애
		TALENT:친애 = 0
	SIF TALENT:창부
		TALENT:창부 = 0
	SIF TALENT:예속
		TALENT:예속 = 0
	;상사상애가 있는 경우, 상사상애상대의[상사상애]를 지워, 함락 소질 기록 플래그를[친애]에 되돌린다
	IF CFLAG:39 == 165
		TALENT:(NO2(CFLAG:LOCAL:41)):상사상애 = 0
		CFLAG:(NO2(CFLAG:LOCAL:41)):39 = 6
	ENDIF
	CFLAG:40 = 0
	CFLAG:41 = -1
	CFLAG:10 = 0
ENDIF

@EVENTEND
#PRI
PLAYER = MASTER
CALL MASTER_CHANGE_ON
CALL MASTER_CHANGE_OFF

@EVENTEND
#LATER
PRINTL 조교를 종료했습니다

;조교후의후처리
IF TEQUIP:촉수질내산란 || TEQUIP:촉수장내산란
	IF TEQUIP:촉수질내산란 && TEQUIP:촉수장내산란
		CALL TRAIN_MESSAGE_DOUBLE_EGGPLAY_OUT
		CALL DOUBLE_EGGPLAY_OUT
	ELSEIF TEQUIP:촉수질내산란
		CALL TRAIN_MESSAGE_EGGPLAY_OUT
		CALL EGGPLAY_OUT
	ELSEIF TEQUIP:촉수장내산란
		CALL TRAIN_MESSAGE_KANTYO_EGGPLAY_OUT
		CALL KANTYO_EGGPLAY_OUT
	ENDIF
ELSEIF BASE:변의 >= 60
	CALL AFTERTRAIN_KANTYO
ENDIF


;조교후행위의 체크
CALL SELF_CHECK

;착유한모유의 매각
CALL SELL_MILK

;조교시에 녹화한 비디오를 매각
CALL SELL_VIDEO

;조교시에 촬영한 사진을 매각
CALL SELL_PICTURE

;조교시로 감소한체력, 기력에 응해체력, 기력의 최대치 상승
CALL EVENT_GROWTH

;무슨 구슬을 얻을 수 있었는지
CALL JUEL_CHECK

;부정의 구슬의 부정 체크
CALL DENIAL_CHECK

BEGIN ABLUP

@JUEL_CHECK
REPEAT 15
	IF PALAM:COUNT < PALAMLV:1
		G = 0
	ELSEIF PALAM:COUNT < PALAMLV:1*3
		G = 1
	ELSEIF PALAM:COUNT < PALAMLV:2
		G = 2
	ELSEIF PALAM:COUNT < PALAMLV:2*3
		G = 10
	ELSEIF PALAM:COUNT < PALAMLV:3
		G = 20
	ELSEIF PALAM:COUNT < PALAMLV:3*2
		G = 100
	ELSEIF PALAM:COUNT < PALAMLV:4
		G = 200
	ELSEIF PALAM:COUNT < PALAMLV:5
		G = 1000
	ELSEIF PALAM:COUNT < PALAMLV:6
		G = 2000
	ELSEIF PALAM:COUNT < PALAMLV:7
		G = 3000
	ELSEIF PALAM:COUNT < PALAMLV:8
		G = 5000
	ELSEIF PALAM:COUNT < PALAMLV:9
		G = 8000
	ELSEIF PALAM:COUNT < 1000000
		G = 12000
	ELSEIF PALAM:COUNT < 5000000
		G = 25000
	ELSEIF PALAM:COUNT < 30000000
		G = 40000
	ELSEIF PALAM:COUNT < 100000000
		G = 60000
	ELSE
		G = 100000
	ENDIF

	IF COUNT == 0
		GOTJUEL:COUNT = G + EX:0 * 1000
	ELSEIF COUNT == 1
		GOTJUEL:COUNT = G + EX:1 * 1000
	ELSEIF COUNT == 2
		GOTJUEL:COUNT = G + EX:2 * 1000
	ELSEIF COUNT == 3
		GOTJUEL:COUNT = G + EX:3 * 1000
	ELSEIF COUNT < 12
		GOTJUEL:COUNT = G
	ELSE
		GOTJUEL:100 += G
	ENDIF
REND

DRAWLINE
PRINTL 조교의 결과:
REPEAT 15
	D = COUNT
	
	IF D == 12
		PRINTFORML %PALAMNAME:100%의 구슬×({JUEL:부정}+{GOTJUEL:100})
		JUEL:부정 += GOTJUEL:100
	ELSEIF D != 4 && D != 13 && D != 14
		PRINTFORML %PALAMNAME:D%의 구슬×({JUEL:D}+{GOTJUEL:D})
		JUEL:D += GOTJUEL:D
	ENDIF
	
REND

PRINTW 이상의 구슬을 얻었습니다

@DENIAL_CHECK
SIF JUEL:부정 == 0
	RETURN 0

$LABEL_1
A = RAND:3 + 5
B = JUEL:부정 / 2
SIF B == 0 && JUEL:부정 > 0
	B = 1
SIF JUEL:A < B
	B = JUEL:A
JUEL:A -= B
JUEL:부정 -= B

SIF B > 0
	PRINTFORML %PALAMNAME:A%의 구슬×{B}감소
SIF JUEL:부정 > 0 && (JUEL:순종 + JUEL:욕정 + JUEL:굴복) > 0
	GOTO LABEL_1

$LABEL_2
A = RAND:3 + 5
B = JUEL:부정 / 2
SIF B == 0 && JUEL:부정 > 0
	B = 1
SIF JUEL:A < B
	B = JUEL:A
JUEL:A -= B
JUEL:부정 -= B
SIF B > 0
	PRINTFORML %PALAMNAME:A%의 구슬×{B}개감소
SIF JUEL:부정 > 0 && (JUEL:순종 + JUEL:욕정 + JUEL:굴복) > 0
	GOTO LABEL_2

DRAWLINE
PRINTL 부정의 구슬과 다른 구슬의 부정이 발생하고 있습니다
PRINTL 그 결과,
REPEAT 13
	D = COUNT
	
	IF D == 12
		PRINTFORML %PALAMNAME:100%의 구슬×({JUEL:부정})
	ELSEIF D != 4
		PRINTFORML %PALAMNAME:D%의 구슬×({JUEL:D})
	ENDIF

REND

PRINTW 이상과 같이 변화했습니다

